<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Network+ Prep Quiz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="manifest" href="../../manifest.json">
    
    <style>
        .top-right-nav {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 1060;
        }

        :root {
            --main-bg: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --sidebar-bg: #1a1a1a;
            --sidebar-active: #4CAF50;
            --sidebar-text: #e0e0e0;
            --answer-bg: #2c2c2c;
            --answer-active: #388E3C;
            --btn-next: #4CAF50; 
            --btn-prev: #2c2c2c;
            --btn-next-text: #fff;
            --modal-bg: #2c2c2c;
            --modal-header-bg: #1e1e1e;
            --progress-bar-bg: #4CAF50;
        }

        body {
            background: var(--main-bg);
            color: var(--text-color);
            font-family: 'Segoe UI', Arial, sans-serif;
            min-height: 100vh;
        }

        .quiz-sidebar {
            background: var(--sidebar-bg);
            border-radius: 18px;
            box-shadow: 0 2px 12px #0008;
            padding: 1rem 0.5rem;
            min-height: 90vh;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .quiz-sidebar .sidebar-btn {
            display: block;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            color: var(--sidebar-text);
            border-radius: 8px;
            margin-bottom: 8px;
            padding: 10px 16px;
            transition: background 0.2s;
            font-weight: 500;
        }

        .quiz-sidebar .sidebar-btn.active,
        .quiz-sidebar .sidebar-btn:focus {
            background: var(--sidebar-active);
            color: #fff;
            outline: none;
        }

        .quiz-sidebar .sidebar-btn.missed {
            background: #5c4033;
            color: #f5e9e2;
        }

        .quiz-sidebar .sidebar-btn.flagged {
            border-left: 5px solid #ffab40;
            background: #59442b;
            color: #f5e9e2;
        }
        
        #quizContainer {
            height: 100vh;
        }

        .reset-quiz-container {
            position: sticky;
            bottom: 0;
            background: var(--sidebar-bg);
            padding-top: 5px;
            padding-bottom: 5px;
            z-index: 10;
            margin-top: auto;
        }

        .reset-quiz-btn {
            width: 100%; 
        }
        
        .main-content-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            justify-content: flex-start;
            position: relative;
        }

        .quiz-title {
            margin-top: 40px;
            font-weight: 700;
            color: var(--sidebar-active);
            font-size: 2rem;
            text-align: center;
            letter-spacing: 1px;
        }
        
        .quiz-card, #quizSetup .card {
            border-radius: 18px;
            background: var(--card-bg);
            border: 1px solid #2c2c2c;
            box-shadow: 0 2px 16px #0008;
            padding: 2rem;
            margin: 1rem 0 2rem 0;
            width: 90%;
        }

        #quizSetup .card {
            color: var(--text-color);
            background: var(--card-bg);
        }
        
        #category-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #444;
            border-radius: .25rem;
            padding: 10px;
        }

        #sidebarList {
            flex-grow: 1; 
            overflow-y: auto; 
            margin-bottom: 1rem; 
        }

        .answer-option {
            border-radius: 10px;
            background: var(--answer-bg);
            margin-bottom: 14px;
            padding: 12px 20px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: background 0.18s, border 0.18s;
        }

        .answer-option.selected {
            background: var(--answer-active);
            border-color: var(--sidebar-active);
            font-weight: 600;
        }

        .answer-option:hover {
            opacity: 0.8;
        }
        
        .nav-btns {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .nav-btn {
            min-width: 140px;
            padding: 12px 0;
            border-radius: 10px;
            font-size: 1.13rem;
            font-weight: 600;
            border: none;
            transition: 0.15s;
        }

        .nav-btn.prev {
            background: var(--btn-prev);
            color: var(--text-color);
            border: 1px solid var(--sidebar-active);
        }

        .nav-btn.next {
            background: var(--btn-next);
            color: var(--btn-next-text);
        }

        .progress-bar {
            background-color: var(--progress-bar-bg);
        }
        
        .modal-content {
            border-radius: 16px;
            background: var(--modal-bg);
            color: var(--text-color);
            border: 1px solid #444;
        }

        .modal-header {
            background: var(--modal-header-bg);
            border-bottom: 1px solid #444;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
        }

        .back-btn {
            display: inline-block;
            padding: 8px 16px;
            background-color: var(--sidebar-active); 
            color: #fff;
            text-decoration: none; 
            border-radius: 5px;
            font-weight: 500;
            border: none;
        }

        .back-btn:hover {
            opacity: 0.9;
            color: #fff;
        }

        .btn-close {
            filter: invert(1) grayscale(100%) brightness(200%);
        }

        .progress-bar-objective {
            display: flex;
            height: 1.2rem;
            overflow: hidden;
            background-color: #3e3e3e;
            border-radius: .375rem;
            box-shadow: inset 0 1px 2px rgba(0,0,0,.2);
        }
        .progress-bar-correct { background-color: #4CAF50; }
        .progress-bar-incorrect { background-color: #dc3545; } 
        .progress-bar-flagged { background-color: #ffc107; } 

    </style>
</head>
<body>
    <div class="top-right-nav">
        <a href="../index.html" class="back-btn">Back to Exam Hub</a>
    </div>

    <div class="container-fluid">
        <div id="quizSetup" class="d-flex justify-content-center align-items-center" style="min-height: 100vh;">
            <div class="card p-4">
                <h3 class="text-center mb-3">Quiz Setup</h3>
                
<fieldset class="mb-3">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <legend class="h5 mb-0">Exam Objectives</legend>
        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="toggleAllCategories(this)">Deselect All</button>
    </div>
    <div id="category-list" class="p-2">
        </div>
</fieldset>

                <div class="mb-3">
                    <label for="numQuestions" class="form-label">Number of Questions: (max 358)</label>
                    <input type="number" class="form-control" id="numQuestions" value="25" min="1">
                </div>

                <div class="form-check mb-4">
                    <input class="form-check-input" type="checkbox" id="randomizeQuestions" checked>
                    <label class="form-check-label" for="randomizeQuestions">
                        Randomize Questions
                    </label>
                </div>
                <button class="btn btn-primary" onclick="startQuiz()" style="background-color: var(--btn-next); border-color: var(--btn-next);">Start Quiz</button>
            </div>
        </div>

        <div class="row flex-nowrap d-none" id="quizContainer">
            <div class="col-md-3 col-lg-2 p-3">
                <div class="quiz-sidebar h-100">
                    <h5 class="mb-2 ms-2">Questions</h5>
                    <div id="counters" class="mb-3 ms-2">
                        <div>Correct: <span id="correct-counter" class="fw-bold text-success">0</span></div>
                        <div>Incorrect: <span id="incorrect-counter" class="fw-bold text-danger">0</span></div>
                        <div>Flagged: <span id="flagged-counter" class="fw-bold text-warning">0</span></div>
                    </div>
                    <hr style="border-top: 1px solid #444;">
                    <div id="sidebarList"></div>
                    <div class="reset-quiz-container">
                        <button class="btn btn-danger reset-quiz-btn" onclick="resetQuiz()">New Quiz</button>
                    </div>
                </div>
            </div>
            <div class="col-md-9 col-lg-10 p-0">
                <div class="main-content-area">
                    <div class="quiz-title">Network+ Practice Quiz</div>
                    <div class="progress mb-4" style="height: 16px; background-color: #444; width: 100vh;">
                        <div class="progress-bar" id="progressBar" style="width: 0%;">0%</div>
                    </div>
                    <div id="quizArea" style="width:100%;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="explanationModal" tabindex="-1" aria-labelledby="explanationLabel" aria-hidden="true">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="explanationLabel">Explanation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="explanationBody"></div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    


//* replace everthing from here*//

    <script>
    const examCategories = [
        "1.1 Compare and contrast various types of security controls.",
        "1.2 Summarize fundamental security concepts.",
        "1.3 Explain the importance of change management processes and the impact to security.",
        "1.4 Explain the importance of using appropriate cryptographic solutions.",
        "2.1 Compare and contrast common threat actors and motivations.",
        ];

    const allQuestions = [
{
    id: 1,
    q: "Which of the following threat actors is the most likely to be hired by a foreign government to attack critical systems located in other countries?",
    type: "single",
    category: "2.1 Compare and contrast common threat actors and motivations.",
    answers: [
        { text: "A. Hacktivist", correct: false, explain: "Incorrect. A hacktivist is typically motivated by political or social beliefs, not hired by governments." },
        { text: "B. Whistleblower", correct: false, explain: "Incorrect. A whistleblower is an insider who exposes wrongdoing within an organization, not an external attacker." },
        { text: "C. Organized crime", correct: true, explain: "Correct. Nation-states may hire organized crime groups to conduct cyberattacks to create plausible deniability. These groups are motivated by financial gain and have the resources and skills for such tasks." },
        { text: "D. Unskilled attacker", correct: false, explain: "Incorrect. An unskilled attacker (or script kiddie) lacks the sophistication required for state-sponsored attacks on critical systems." }
    ]
},

    ];

//* to here *//
        
        allQuestions.forEach((q, index) => { q.displayId = `Q${index + 1}`; });

        let questions = [];
        let currentQ = 0;

        function populateCategories() {
            const listEl = document.getElementById('category-list');
            let html = '';
            examCategories.forEach(cat => {
                html += `<div class="form-check">
                    <input class="form-check-input category-checkbox" type="checkbox" value="${cat}" id="cat-${cat.replace(/\s+/g, '')}" checked>
                    <label class="form-check-label" for="cat-${cat.replace(/\s+/g, '')}">${cat}</label>
                </div>`;
            });
            listEl.innerHTML = html;
        }

        function startQuiz() {
            const selectedCategories = Array.from(document.querySelectorAll('.category-checkbox:checked')).map(cb => cb.value);
            const numToAsk = parseInt(document.getElementById('numQuestions').value, 10);
            
            if (selectedCategories.length === 0) {
                alert("Please select at least one category.");
                return;
            }

            const shouldRandomize = document.getElementById('randomizeQuestions').checked;
            const setupEl = document.getElementById('quizSetup');
            const quizEl = document.getElementById('quizContainer');
            
            let questionPool = allQuestions.filter(q => selectedCategories.includes(q.category));

            if (questionPool.length === 0) {
                alert("No questions found for the selected categories.");
                return;
            }

            if (shouldRandomize) {
                for (let i = questionPool.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [questionPool[i], questionPool[j]] = [questionPool[j], questionPool[i]];
                }
            }
            
            const finalQuestionCount = Math.min(numToAsk, questionPool.length);
            questions = questionPool.slice(0, finalQuestionCount).map(q => ({ ...q, selected: [], flagged: false }));

            if (questions.length > 0) {
                setupEl.classList.remove('d-flex');
                setupEl.classList.add('d-none');
                quizEl.classList.remove('d-none');
                document.querySelector('.progress').style.display = 'flex';
                document.querySelector('.quiz-title').textContent = 'Network+ Practice Quiz';
                
                currentQ = 0;
                renderQuiz();
            } else {
                alert("Something went wrong. No questions were prepared for the quiz.");
            }
        }

        function resetQuiz() {
            const setupEl = document.getElementById('quizSetup');
            const quizEl = document.getElementById('quizContainer');
            questions = [];
            quizEl.classList.add('d-none');
            setupEl.classList.remove('d-none');
            setupEl.classList.add('d-flex');
        }

        function toggleAllCategories(button) {
            const checkboxes = document.querySelectorAll('.category-checkbox');
            const shouldBeChecked = button.innerText === 'Select All';
            checkboxes.forEach(cb => {
            cb.checked = shouldBeChecked;
        });

        button.innerText = shouldBeChecked ? 'Deselect All' : 'Select All';
        }

        function renderQuiz() {
            renderSidebar();
            let html = '';
            if (!questions[currentQ]) return;

            const q = questions[currentQ];
            const nextButtonHtml = currentQ === questions.length - 1
                ? `<button class="nav-btn next" onclick="finishQuiz()">Finish</button>`
                : `<button class="nav-btn next" onclick="nextQuestion()">Next</button>`;

            html += `<div class="quiz-card" id="questionCard${currentQ}">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-4">${q.displayId}: ${q.q}</h5>
                    <div>
                        <button class="btn btn-sm btn-outline-warning me-2" onclick="flagQuestion()">${q.flagged ? 'Unflag' : 'Flag'}</button>
                    </div>
                </div>
                <div>`;

            q.answers.forEach((answer, aIdx) => {
                if (q.type === "multiple") {
                    const isSelected = q.selected.includes(aIdx);
                    html += `<div class="answer-option${isSelected ? ' selected' : ''}" onclick="selectAnswer(${aIdx}, true)">
                        <input type="checkbox" ${isSelected ? "checked" : ""} style="margin-right:10px;"/>${answer.text}
                    </div>`;
                } else {
                    const isSelected = q.selected[0] === aIdx;
                    html += `<div class="answer-option${isSelected ? ' selected' : ''}" onclick="selectAnswer(${aIdx}, false)">
                        <input type="radio" name="q${currentQ}" ${isSelected ? "checked" : ""} style="margin-right:10px;"/>${answer.text}
                    </div>`;
                }
            });

            html += `</div>
                <div class="nav-btns mt-4">
                    <button class="nav-btn prev" onclick="prevQuestion()" ${currentQ === 0 ? "disabled" : ""}>Previous</button>
                    ${nextButtonHtml}
                </div>
            </div>`;
            document.getElementById('quizArea').innerHTML = html;
            updateCounters();
        }
        
        function renderSidebar() {
            let sidebar = "";
            questions.forEach((q, i) => {
                let btnClass = "sidebar-btn";
                if (i === currentQ) btnClass += " active";
                if (q.flagged) btnClass += " flagged";
                if (isAnswered(q) && !isCorrect(i)) btnClass += " missed";
                sidebar += `<button class="${btnClass}" onclick="showQuestion(${i})">${q.displayId}</button>`;
            });
            document.getElementById('sidebarList').innerHTML = sidebar;
        }

        function updateCounters() {
            const correctCount = questions.filter((q, i) => isAnswered(q) && isCorrect(i)).length;
            const incorrectCount = questions.filter((q, i) => isAnswered(q) && !isCorrect(i)).length;
            const flaggedCount = questions.filter(q => q.flagged).length;

            document.getElementById('correct-counter').innerText = correctCount;
            document.getElementById('incorrect-counter').innerText = incorrectCount;
            document.getElementById('flagged-counter').innerText = flaggedCount;
            updateProgress();
        }
        
        function updateProgress() {
            const correctCount = questions.filter((q, i) => isCorrect(i)).length;
            const percent = questions.length > 0 ? Math.round(100 * correctCount / questions.length) : 0;
            const bar = document.getElementById('progressBar');
            bar.style.width = percent + "%";
            bar.innerText = percent + "%";
        }

        function selectAnswer(aIdx, isMulti) {
            let q = questions[currentQ];
            if (isMulti) {
                const selIndex = q.selected.indexOf(aIdx);
                if (selIndex >= 0) {
                    q.selected.splice(selIndex, 1);
                } else {
                    q.selected.push(aIdx);
                }
            } else {
                q.selected = [aIdx];
            }
            renderQuiz();
            showExplanation(currentQ, aIdx, isMulti);
        }

        function flagQuestion() {
            questions[currentQ].flagged = !questions[currentQ].flagged;
            renderQuiz();
        }

        function showQuestion(idx) {
            currentQ = idx;
            renderQuiz();
        }

        function nextQuestion() {
            if (currentQ < questions.length - 1) {
                currentQ++;
                renderQuiz();
            }
        }

        function prevQuestion() {
            if (currentQ > 0) {
                currentQ--;
                renderQuiz();
            }
        }
        
        function showExplanation(qIdx, aIdx, isMulti) {
            const q = questions[qIdx];
            let explainHtml = "";
            if (isMulti) {
                q.selected.forEach(selectedIndex => {
                    explainHtml += `<div style="margin-bottom:10px;"><strong>${q.answers[selectedIndex].text}</strong><br>${q.answers[selectedIndex].explain}</div>`;
                });
            } else {
                explainHtml = `<div><strong>${q.answers[aIdx].text}</strong><br>${q.answers[aIdx].explain}</div>`;
            }
            document.getElementById('explanationBody').innerHTML = explainHtml;
            const modalEl = document.getElementById('explanationModal');
            const modalInstance = bootstrap.Modal.getOrCreateInstance(modalEl);
            modalInstance.show();
        }

        function finishQuiz() {
            const reportHtml = generateReport();
            document.getElementById('quizArea').innerHTML = reportHtml;
            document.querySelector('.progress').style.display = 'none';
            document.querySelector('.quiz-title').textContent = 'Quiz Report';
        }

        function generateReport() {
            const totalQuestions = questions.length;
            let correctCount = 0;
            let incorrectCount = 0;
            let flaggedCount = 0;
            const objectiveStats = {};

            questions.forEach((q, index) => {
                if (isCorrect(index)) {
                    correctCount++;
                } else if (isAnswered(q)) {
                    incorrectCount++;
                }
                if (q.flagged) {
                    flaggedCount++;
                }

                const category = q.category;
                if (!objectiveStats[category]) {
                    objectiveStats[category] = { total: 0, correct: 0, incorrect: 0, flagged: 0 };
                }

                objectiveStats[category].total++;
                if (isCorrect(index)) {
                    objectiveStats[category].correct++;
                } else if (isAnswered(q)) {
                    objectiveStats[category].incorrect++;
                }
                if (q.flagged) {
                    objectiveStats[category].flagged++;
                }
            });

            const overallPercentage = totalQuestions > 0 ? ((correctCount / totalQuestions) * 100).toFixed(1) : 0;

            let reportHtml = `<div class="quiz-card">`;
            
            reportHtml += `
                <h4 class="mb-4">Overall Score</h4>
                <div class="display-4 text-center mb-3" style="color: var(--sidebar-active);">${overallPercentage}%</div>
                <div class="d-flex justify-content-around text-center mb-5">
                    <div>
                        <div class="fs-4 fw-bold text-success">${correctCount}</div>
                        <div class="text-muted; color: white;">Correct</div>
                    </div>
                    <div>
                        <div class="fs-4 fw-bold text-danger">${incorrectCount}</div>
                        <div class="text-muted; color: white;">Incorrect</div>
                    </div>
                    <div>
                        <div class="fs-4 fw-bold text-warning">${flaggedCount}</div>
                        <div class="text-muted; color: white;">Flagged</div>
                    </div>
                </div>
                <hr style="border-top: 1px solid #444;">
            `;

            reportHtml += `<h4 class="mt-5 mb-4">Breakdown by Objective</h4>`;

            for (const category in objectiveStats) {
                if (Object.hasOwnProperty.call(objectiveStats, category)) {
                    const stats = objectiveStats[category];
                    const { total, correct, incorrect, flagged } = stats;
                    const correctPercent = total > 0 ? (correct / total) * 100 : 0;
                    const incorrectPercent = total > 0 ? (incorrect / total) * 100 : 0;
                    const flaggedPercent = total > 0 ? (flagged / total) * 100 : 0;

                    reportHtml += `
                        <div class="mb-4">
                            <p class="mb-1"><strong>${category}</strong></p>
                            <div class="d-flex justify-content-between small text-muted; color: white; mb-1">
                                <span>Total: ${total}</span>
                                <span>
                                    <span class="text-success">Correct: ${correct} (${((correct/total)*100).toFixed(0)}%)</span> | 
                                    <span class="text-danger">Incorrect: ${incorrect} (${((incorrect/total)*100).toFixed(0)}%)</span> |
                                    <span class="text-warning">Flagged: ${flagged}</span>
                                </span>
                            </div>
                            <div class="progress-bar-objective">
                                <div class="progress-bar-correct" style="width: ${correctPercent}%" title="Correct: ${correctPercent.toFixed(1)}%"></div>
                                <div class="progress-bar-incorrect" style="width: ${incorrectPercent}%" title="Incorrect: ${incorrectPercent.toFixed(1)}%"></div>
                            </div>
                        </div>
                    `;
                }
            }

            reportHtml += `</div>`;
            return reportHtml;
        }

        function isAnswered(q) {
            return q.selected && q.selected.length > 0;
        }

        function isCorrect(idx) {
            const q = questions[idx];
            if (!isAnswered(q)) return false;
            if (q.type === "multi") {
                const correctIndices = q.answers.map((a, i) => a.correct ? i : -1).filter(i => i >= 0);
                const selectedIndices = [...q.selected].sort((a,b)=>a-b);
                if (correctIndices.length !== selectedIndices.length) return false;
                return correctIndices.every((val, index) => val === selectedIndices[index]);
            } else {
                return q.answers[q.selected[0]] && q.answers[q.selected[0]].correct;
            }
        }

        document.addEventListener('DOMContentLoaded', populateCategories);

    </script>
</body>
</html>