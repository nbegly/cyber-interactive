<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sim 4: Network Security</title>
    <link rel="stylesheet" href="../../../../assets/style.css">
    <style>
        .sim-top-bar { 
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; 
        }

        .info-btn { 
            padding: 8px; background-color: var(--interactive-blue); border: none; border-radius: 5px; cursor: pointer; color: white; line-height: 0; 
        }

        .info-btn:hover { 
            background-color: var(--interactive-blue-hover); 
        }

        .info-btn svg { 
            width: 24px; height: 24px; fill: currentColor; 
        }

        #sim78-content {
            background-color: var(--bg-dark-secondary);
            padding: 2rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            position: relative;
            font-family: monospace;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-gap: 2rem;
        }

        .site-container {
            border: 2px solid var(--interactive-blue);
            border-radius: 8px;
            padding: 1rem;
            position: relative;
        }

        .site-container::before {
            content: attr(data-site-name);
            position: absolute;
            top: -0.7em;
            left: 1em;
            background-color: var(--bg-dark-secondary);
            padding: 0 0.5em;
            font-weight: bold;
            color: var(--interactive-blue);
        }

        .components-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .component {
            background-color: var(--bg-dark-tertiary);
            border: 1px solid var(--border-color);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        .component:hover {
            border-color: var(--border-color-light);
        }

        .component.selected {
            background-color: green;
            border-color: rgb(46, 161, 46);
            color: white;
            transform: scale(1.05);
        }

        #action-container {
            grid-column: 1 / -1;
            margin-top: 1rem;
            padding: 1rem;
            border: 1px solid var(--border-color-light);
            border-radius: 8px;
        }

        #action-container label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        #action-container select {
            width: 100%;
            background: var(--bg-dark-tertiary);
            color: white;
            border: 1px solid var(--border-color);
            padding: 8px;
            border-radius: 4px;
        }

    </style>
</head>
<body>

    <div class="sim-container">
        <div class="sim-top-bar">
            <a href="../index.html" class="back-btn">Back to SecurityX Menu</a>
            <button id="infoBtn" class="info-btn" title="Show Instructions">
                <svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </button>
        </div>

        <h3>Sim 4: Network Security</h3>
        <p>Select all components with environmental impact potential, then choose the best corrective action.</p>
        
        <div id="sim78-content">
            <div class="site-container" data-site-name="Site A">
                <div class="components-grid" id="site-a-grid">
                    </div>
            </div>
            <div class="site-container" data-site-name="Site B">
                <div class="components-grid" id="site-b-grid">
                     </div>
            </div>
            <div id="action-container">
                <label for="corrective-action">Which of the following changes will best reduce the risk of incident reoccurrence?</label>
                <select id="corrective-action">
                    </select>
            </div>
        </div>
        
        <div class="sim-controls">
             <div></div>
             <div>
                <button class="sim-check-btn" id="checkBtn">Check Answer</button>
                <button class="sim-reset-btn" id="resetBtn">Reset All</button>
             </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <pre id="modal-body-content" style="white-space: pre-wrap; font-family: sans-serif;"></pre>
            <button class="modal-close-btn">Close</button>
        </div>
    </div>

    <script>
        const modal = document.getElementById("modal");
        const modalBody = document.getElementById("modal-body-content");
        function showModal(message, isCentered = false) {
            modalBody.textContent = message;
            modal.querySelector('.modal-content').classList.toggle('centered-text', isCentered);
            modal.style.display = "flex";
        }
        function closeModal() { modal.style.display = "none"; }
        modal.querySelector('.modal-close-btn').onclick = closeModal;
        modal.onclick = e => { if (e.target.id === 'modal') closeModal(); };

        const sim78 = {
            data: {
                info: `An incident occurred at Site A when an attacker successfully caused water pressure to increase in the pump room.\n\nThe organization is concerned about reoccurrence of this attack and that similar attacks might be successful on other cyber-physical systems within the network.\n\nAll devices and components reside on a flat network within the 10.1.0.0/16 space.\n\nINSTRUCTIONS\nTake the appropriate actions to reduce the risk of reoccurrence of this and other environmental security vulnerabilities. Select the component(s) at Sites A and B that have environmental impact potential. Then, select the corrective action that will best reduce the risk of incident reoccurrence.`,
                components: {
                    siteA: ["Application server 2", "Web server 1", "VPN concentrator", "DNS", "Directory server", "SCADA master controller", "Application server 1", "Pumps", "HVAC", "PLC 1", "PLC 2"],
                    siteB: ["VPN concentrator", "File server", "Application server 3", "Application server 4", "Pumps", "PLC"]
                },
                actions: ["Apply patches to the OS/firmware", "Configure MFA", "Implement a NIDS", "Configure a honeypot", "Isolate from the network", "Configure 802.1x in EAP-TLS", "Place components in a perimeter network", "Deploy a load balancer"],
                correctAnswers: {
                    components: new Set(["scada-master-controller", "pumps-a", "hvac", "plc-1", "plc-2", "pumps-b", "plc-b"]),
                    action: "Place components in a perimeter network"
                }
            },
            state: {
                selectedComponents: new Set()
            },
            setup: function() {
                this.state.selectedComponents.clear();
                
                const siteAGrid = document.getElementById('site-a-grid');
                const siteBGrid = document.getElementById('site-b-grid');
                const actionSelect = document.getElementById('corrective-action');

                const createComponentDiv = (name, site) => {
                    const id = name.toLowerCase().replace(/\s+/g, '-') + (site ? `-${site}` : '');
                    const div = document.createElement('div');
                    div.className = 'component';
                    div.id = id;
                    div.textContent = name;
                    return div;
                };

                siteAGrid.innerHTML = '';
                this.data.components.siteA.forEach(name => {
                    let idSuffix = "a";
                    if (name.includes("PLC")) idSuffix = name.slice(-1);
                    siteAGrid.appendChild(createComponentDiv(name, name.includes("PLC") ? name.slice(-1) : 'a'));
                });

                siteBGrid.innerHTML = '';
                this.data.components.siteB.forEach(name => {
                     siteBGrid.appendChild(createComponentDiv(name, 'b'));
                });

                actionSelect.innerHTML = `<option value="" selected disabled>Select corrective action</option>` + this.data.actions.map(a => `<option value="${a}">${a}</option>`).join('');
                
                document.querySelectorAll('.component.selected').forEach(c => c.classList.remove('selected'));
            },
            toggleComponent: function(element) {
                if (!element) return;
                element.classList.toggle('selected');
                if (this.state.selectedComponents.has(element.id)) {
                    this.state.selectedComponents.delete(element.id);
                } else {
                    this.state.selectedComponents.add(element.id);
                }
            },
            check: function() {
                const selectedAction = document.getElementById('corrective-action').value;
                
                const correctComps = this.data.correctAnswers.components;
                const userComps = this.state.selectedComponents;
                
                const componentsAreCorrect = correctComps.size === userComps.size && [...correctComps].every(id => userComps.has(id));
                const actionIsCorrect = selectedAction === this.data.correctAnswers.action;

                if (componentsAreCorrect && actionIsCorrect) {
                    showModal("Correct! Network segmentation is the best solution, and you have correctly identified all at-risk environmental systems.", true);
                } else {
                    let message = "Incorrect.\n";
                    if (!actionIsCorrect) {
                        message += "\nThe selected corrective action does not best address the core issue of a flat network.\n";
                    }
                    if (!componentsAreCorrect) {
                        message += "\nReview the components selected. Not all systems with environmental impact potential have been chosen.\n";
                    }
                    showModal(message, true);
                }
            },
            initEventListeners: function() {
                document.getElementById('checkBtn').addEventListener('click', () => this.check());
                document.getElementById('resetBtn').addEventListener('click', () => this.setup());
                document.getElementById('infoBtn').onclick = () => showModal(this.data.info);
                document.getElementById('sim78-content').addEventListener('click', (e) => {
                    if (e.target.classList.contains('component')) {
                        this.toggleComponent(e.target);
                    }
                });
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            sim78.setup();
            sim78.initEventListeners();
        });
    </script>
<script src="../../../../disable_dev_tools.js"></script>
</body>
</html>