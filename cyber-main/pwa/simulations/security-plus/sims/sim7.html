<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sim 7: CSR Drag & Drop</title>
    <link rel="stylesheet" href="../../../../assets/style.css">
    <style>
        .sim-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .info-btn {
            padding: 8px;
            background-color: var(--interactive-blue);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
            line-height: 0;
        }

        .info-btn:hover {
            background-color: var(--interactive-blue-hover);
        }

        .info-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .sim7-layout-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .sim7-left-panel {
            flex: 1; 
        }

        .sim7-right-panel {
            flex: 3; 
        }

        .csr-container { 
            background-color: var(--bg-dark-secondary); 
            padding: 20px; 
            border-radius: 8px; 
        }

        .csr-table { 
            display: grid; 
            grid-template-columns: 1fr 2fr; 
            gap: 10px; 
            border: 1px solid var(--border-color); 
            padding: 10px; 
            border-radius: 5px; 
        }

        .csr-header { 
            font-weight: bold; 
            color: var(--accent-green); 
            padding-bottom: 5px; 
            border-bottom: 2px solid var(--accent-green); 
        }

        .drop-zone { 
            background-color: var(--bg-dark-main); 
            border: 2px dashed var(--border-color); 
            border-radius: 4px; 
            padding: 10px; 
            min-height: 2.5em; 
            text-align: center; 
            transition: all 0.2s; 
        }

        .drop-zone.drag-over { 
            border-style: solid; 
            border-color: var(--accent-green); 
            background-color: var(--bg-dark-tertiary); 
        }

        .drop-zone:not(:empty) { 
            border-style: solid; 
            border-color: var(--interactive-blue); 
        }

        .palette { 
            padding: 15px; 
            background-color: var(--bg-dark-tertiary); 
            border-radius: 8px; 
            margin-bottom: 20px;
        }

        .palette h4 { 
            margin-top: 0; 
            color: var(--accent-green);
        }

        .palette-items { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px; 
        }

        .draggable { 
            background-color: var(--interactive-blue); 
            color: white; 
            padding: 8px 12px; 
            border-radius: 4px; 
            cursor: grab; 
            transition: background-color 0.2s; 
            user-select: none; 
        }

        .draggable:hover { 
            background-color: var(--interactive-blue-hover); 
        }

        .draggable.used { 
            display: none; 
        }

    </style>
</head>
<body>

    <div class="sim-container">
        <div class="sim-top-bar">
        <a href="../index.html" class="back-btn">Back to Menu</a>
            <button id="infoBtn" class="info-btn" title="Show Instructions">
                <svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </button>
        </div>

        <h3>Sim 7: Certificate Signing Request</h3>
        <div class="sim7-layout-container">
            <div class="sim7-left-panel">
                <div class="palette">
                    <h4>Extensions</h4>
                    <div class="palette-items" id="palette-extensions"></div>
                </div>
                <div class="palette">
                    <h4>Values</h4>
                    <div class="palette-items" id="palette-values"></div>
                </div>
            </div>
            <div class="sim7-right-panel">
                <div class="csr-container">
                    <div class="csr-table">
                        <div class="csr-header">Extension</div>
                        <div class="csr-header">Value</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="sim-controls">
            <div></div>
            <div>
                <button class="sim-check-btn" id="checkBtn">Check Answer</button>
                <button class="sim-reset-btn" id="resetBtn">Reset Sim</button>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div id="modal-body-content"></div>
            <button class="modal-close-btn" onclick="closeModal()">Close</button>
        </div>
    </div>

    <script>
        const modal = document.getElementById("modal");
        const modalBody = document.getElementById("modal-body-content");
        function showModal(content, isCentered = true) {
            modalBody.innerHTML = '';
            if (typeof content === 'string') {
                const p = document.createElement('p');
                p.style.whiteSpace = 'pre-wrap';
                p.textContent = content;
                modalBody.appendChild(p);
            } else {
                modalBody.appendChild(content);
            }
            modal.querySelector('.modal-content').classList.toggle('centered-text', isCentered);
            modal.style.display = "flex";
        }
        function closeModal() { modal.style.display = "none"; }
        modal.onclick = e => { if (e.target.id === 'modal') closeModal(); };

        const sim7 = {
            state: {},
            data: {
                info: `SIMULATION\nLeveraging the supplied information below, complete the CSR for the server to set up TLS (HTTPS).\n\nHOSTNAME: ws01\nDOMAIN: comptia.org\nCNAME: homesite\n\nINSTRUCTIONS\nDrag the various data points to the correct locations within the CSR. Extension criteria belong in the left-hand column and values belong in the corresponding row in the right-hand column. Each item can only be used once.\n\nIf at any time you would like to bring back the initial state of the simulation, please click the Reset Sim button.`,
                extensions: ['subjAltName', 'policyIdentifier', 'commonName', 'extendedKeyUsage'],
                values: [
                    'URL=http://homesite.comptia.org/home.aspx', 'serverAuth',
                    'DNS Name=homesite.comptia.org', 'ws01.comptia.org', 'clientAuth',
                    'OCSP;URI:http://ocsp.pki.comptia.org', 'DNS Name=*.comptia.org'
                ],
                correctAnswers: {
                    'subjAltName': 'ws01.comptia.org',
                    'commonName': 'DNS Name=homesite.comptia.org',
                    'extendedKeyUsage': 'serverAuth',
                    'policyIdentifier': 'OCSP;URI:http://ocsp.pki.comptia.org'
                }
            },
            setup: function() {
                this.state = {
                    row1: { Extension: null, Value: null }, row2: { Extension: null, Value: null },
                    row3: { Extension: null, Value: null }, row4: { Extension: null, Value: null }
                };

                const csrTable = document.querySelector('.csr-table');
                csrTable.querySelectorAll('.drop-zone').forEach(el => el.remove());
                Object.keys(this.state).forEach(rowId => {
                    csrTable.innerHTML += `<div class="drop-zone" data-type="Extension" data-row="${rowId}"></div><div class="drop-zone" data-type="Value" data-row="${rowId}"></div>`;
                });

                const extPalette = document.getElementById('palette-extensions');
                const valPalette = document.getElementById('palette-values');
                extPalette.innerHTML = '';
                valPalette.innerHTML = '';

                const createDraggable = (item, type, container) => {
                    const el = document.createElement('div');
                    el.id = `draggable-${type}-${item.replace(/[^a-zA-Z0-9]/g, "")}`;
                    el.className = 'draggable';
                    el.textContent = item;
                    el.draggable = true;
                    el.dataset.type = type;
                    el.dataset.value = item;
                    container.appendChild(el);
                };

                this.data.extensions.forEach(item => createDraggable(item, 'Extension', extPalette));
                this.data.values.forEach(item => createDraggable(item, 'Value', valPalette));

                let draggedId = null;
                document.querySelectorAll('.draggable').forEach(item => {
                    item.addEventListener('dragstart', e => {
                        draggedId = e.target.id;
                        e.dataTransfer.setData('text/plain', draggedId);
                    });
                });

                document.querySelectorAll('.drop-zone').forEach(zone => {
                    zone.addEventListener('dragover', e => {
                        e.preventDefault();
                        const draggable = document.getElementById(draggedId);
                        if (draggable && zone.dataset.type === draggable.dataset.type && !zone.hasChildNodes()) {
                            zone.classList.add('drag-over');
                        }
                    });
                    zone.addEventListener('dragleave', e => zone.classList.remove('drag-over'));
                    zone.addEventListener('drop', e => {
                        e.preventDefault();
                        zone.classList.remove('drag-over');
                        const id = e.dataTransfer.getData('text');
                        const draggable = document.getElementById(id);
                        if (draggable && zone.dataset.type === draggable.dataset.type && !zone.hasChildNodes()) {
                            zone.textContent = draggable.textContent;
                            draggable.classList.add('used');
                            const row = zone.dataset.row;
                            const type = zone.dataset.type;
                            this.state[row][type] = draggable.dataset.value;
                        }
                    });
                });
            },
            check: function() {
                const userAnswers = {};
                for (const rowKey in this.state) {
                    const row = this.state[rowKey];
                    if (row.Extension && row.Value) {
                        userAnswers[row.Extension] = row.Value;
                    }
                }
                
                let correctCount = 0;
                const totalPairs = Object.keys(this.data.correctAnswers).length;

                for (const ext in this.data.correctAnswers) {
                    if (userAnswers[ext] === this.data.correctAnswers[ext]) {
                        correctCount++;
                    }
                }

                const isCorrect = (correctCount === totalPairs && Object.keys(userAnswers).length === totalPairs);
                
                showModal(isCorrect ? "Correct! The Certificate Signing Request is configured properly." : "Incorrect. Please review the extension and value pairs.");
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            sim7.setup();
            document.getElementById('checkBtn').addEventListener('click', () => sim7.check());
            document.getElementById('resetBtn').addEventListener('click', () => sim7.setup());
            document.getElementById('infoBtn').onclick = () => {
                showModal(sim7.data.info, false);
            };
        });
    </script>
<script src="../../../../disable_dev_tools.js"></script>
</body>
</html>
