<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sim: Threat Intelligence Remediation</title>
    <link rel="stylesheet" href="../../../../assets/style.css">
    <style>
        .sim-top-bar {
            display: flex;
            justify-content: space-between; 
            align-items: center;
            margin-bottom: 1rem;
        }

        #infoModal .modal-body {
            white-space: pre-wrap; 
            line-height: 1.6;  
        }

        .info-btn {
            padding: 8px;
            background-color: var(--interactive-blue);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
            line-height: 0;
        }

        .info-btn:hover {
            background-color: var(--interactive-blue-hover);
        }

        .info-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .sim-main-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .grid-item {
            background-color: var(--bg-dark-secondary, #2d2d2d);
            border: 1px solid var(--border-color, #444);
            border-radius: 8px;
            padding: 5px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
        }

        .grid-item:hover {
            background-color: #3c3c3c;
            transform: translateY(-2px);
        }

        .grid-item h4 {
            margin-top: 5px;
            color: var(--accent-green, #2b9a2b);
        }

        .terminal-container {
            border: 1px solid var(--border-color, #444);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
            height: 400px;
            display: flex;
            flex-direction: column;
        }

        .terminal-tabs {
            display: flex;
            background-color: var(--bg-dark-secondary, #2d2d2d);
        }

        .terminal-tab-btn {
            padding: 10px 15px;
            cursor: pointer;
            background-color: transparent;
            border: none;
            color: var(--text-dark, #ccc);
            font-size: 1em;
            border-bottom: 3px solid transparent;
        }

        .terminal-tab-btn.active {
            border-bottom-color: var(--accent-green, #2b9a2b);
            color: var(--text-light, #f0f0f0);
            background-color: #000;
        }

        .terminal {
            display: none; 
            flex-grow: 1; 
            min-height: 0; 
            background-color: #000;
            color: #2b9a2b;
            flex-direction: column;
        }

        .terminal.active {
            display: flex;
        }

        .terminal-output {
            flex-grow: 1;
            overflow-y: auto;
            white-space: pre-wrap;
            min-height: 0;
            padding: 10px;
            font-family: 'Courier New', Courier, monospace;
        }

        .terminal-input-line {
            display: flex;
            border-top: 1px solid var(--border-color, #444);
        }

        .terminal-prompt {
            padding: 5px 10px;
            background-color: var(--bg-dark-secondary, #2d2d2d);
        }

        .terminal-input {
            flex-grow: 1;
            background-color: transparent;
            border: none;
            color: #f0f0f0;
            padding: 5px;
            font-family: 'Courier New', Courier, monospace;
        }

        .terminal-input:focus {
            outline: none;
        }

        .browser-bar {
            display: flex;
            align-items: center;
            padding: 8px;
            background-color: #3c3c3c; 
            border-bottom: 1px solid #555;
            border-radius: 8px 8px 0 0;
        }

        .window-controls {
            display: flex;
            gap: 6px;
            margin-right: 15px;
        }

        .dot {
            height: 12px;
            width: 12px;
            border-radius: 50%;
        }

        .dot.red { background-color: #ff5f56; }
        .dot.yellow { background-color: #ffbd2e; }
        .dot.green { background-color: #27c93f; }

        .address-bar {
            flex-grow: 1;
            background-color: var(--bg-dark-main, #1e1e1e);
            border-radius: 4px;
            padding: 5px 10px;
            font-family: 'Segoe UI', sans-serif;
            font-size: 14px;
            color: #ccc;
            border: 1px solid #555;
        }

        .webpage-modal .modal-content {
            background-color: var(--bg-dark-secondary, #2d2d2d);
            color: var(--text-light, #f0f0f0);
            border: 1px solid #555;
            padding: 0; 
        }

        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); 
            justify-content: center;
            align-items: center;
        }

        .webpage-modal .modal-body {
            padding: 20px;
            font-family: 'Segoe UI', sans-serif;
        }

        .webpage-modal .modal-body h3 {
            margin-top: 0;
            color: var(--text-light, #f0f0f0);
            font-size: 1.1em;
        }

        .webpage-modal .modal-body table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .webpage-modal .modal-body th, 
        .webpage-modal .modal-body td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color, #444);
        }

        .webpage-modal .modal-body th {
            background-color: #3c3c3c;
            color: var(--accent-green, #2b9a2b);
        }
    </style>
</head>
<body>
<div class="sim-container">
    <div class="sim-top-bar">
        <a href="../index.html" class="back-btn">Back to Menu</a>
        <button id="infoBtn" class="info-btn" title="Show Instructions">
        <svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg></button>
    </div>

<h3>Sim 15: Threat Intelligence Remediation</h3>

<div class="sim-main-grid">
  <div class="grid-item" data-modal="threatFeed1">
    <h4>Threat Feed: Malicious Activity Against Peers</h4>
    <p>Malicious Activity From Previous Month</p>
  </div>
  <div class="grid-item" data-modal="threatFeed2">
    <h4>Threat Feed: Bad Actors for the Dark Web</h4>
    <p>Today's Updated Threat Intelligence</p>
  </div>
</div>

<div id="threatFeed1" class="modal webpage-modal">
  <div class="modal-content"></div>
</div>

<div id="threatFeed2" class="modal webpage-modal">
  <div class="modal-content"></div>
</div>

    <div class="terminal-container">
        <div class="terminal-tabs">
            <button class="terminal-tab-btn active" data-terminal="webServer">Web Server</button>
            <button class="terminal-tab-btn" data-terminal="crmServer">CRM Server</button>
        </div>
        <div id="webServer" class="terminal active">
            </div>
        <div id="crmServer" class="terminal">
            </div>
    </div>

    <div id="infoModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Instructions</h3>
        </div>
        <div class="modal-body">
        </div>
    </div>
</div>
    <div class="sim-controls">
        <div>
            <button class="sim-check-btn" id="checkBtn">Check Answer</button>
            <button class="sim-reset-btn" id="resetBtn">Reset Sim</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const simData = {
    info: `You are a security operations analyst for a banking institution. Your main job function is to compare current, high-fidelity threat intelligence feeds to activity occurring on the bank's web server and customer relationship management (CRM) server.

Instructions:
- Review the appropriate threat intelligence feed
- Determine if your servers are targeted
- Remediate any compromise by stopping only the process connecting to bad hosts and removing the associated file

Type 'help' to view a list of available commands for each console.`,
    threatFeeds: {
        threatFeed1: {
            title: "Internal Security Operations Center > Malicious Activity Against Peers",
            url: "https://internal.soc-portal.com/peer-activity",
            headers: ["Source IP Address", "Service", "Confidence Level", "Attack Frequency", "Verified / Unverified"],
            rows: [
                ["147.68.169.52", "HTTPS", "Medium", "High", "Unverified"],
                ["53.29.47.46", "HTTPS", "High", "Low", "Unverified"],
                ["76.17.89.65", "MSSQL", "High", "Low", "Unverified"],
                    ["83.67.47.57", "SFTP", "Low", "Medium", "Unverified"],
                    ["51.65.12.24", "HTTPS", "Medium", "Low", "Unverified"],
                    ["3.60.19.62", "HTTPS", "High", "Medium", "Unverified"],
                    ["24.64.19.25", "DNS", "High", "Low", "Unverified"],
                    ["97.19.78.54", "HTTPS", "Low", "Low", "Unverified"],
                    ["193.28.47.78", "VNC", "High", "Low", "Unverified"],
                    ["99.30.17.99", "RDP", "Low", "High", "Unverified"]
                ]
            },
        threatFeed2: {
            title: "Internal Security Operations Center > Bad Actors for the Dark Web",
            url: "https://internal.soc-portal.com/darkweb-actors",
            headers: ["Source IP Address", "Service", "Confidence Level", "Attack Frequency", "Industry Vertical"],
            rows: [
                ["52.104.29.42", "DNS", "High", "Medium", "Retail"],
                ["52.104.29.42", "HTTPS", "Low", "Low", "Retail"],
                ["28.47.62.125", "HTTPS", "Medium", "Medium", "Banking"],
                    ["110.12.213.189", "HTTPS", "Low", "Low", "Banking"],
                    ["110.12.213.189", "MSSQL", "High", "Low", "Banking"],
                    ["36.220.4.27", "SSH", "High", "Low", "Healthcare"],
                    ["36.220.4.27", "VNC", "High", "Low", "Healthcare"],
                    ["36.220.4.27", "FTP", "High", "Low", "Healthcare"],
                    ["66.101.22.80", "HTTPS", "Low", "Medium", "Education"],
                    ["66.101.22.180", "HTTPS", "High", "High", "Education"]
                ]
            }
        },
        consoles: {
            webServer: {
                prompt: "webserver> ",
                welcome: "Connection established to Web Server.\nType 'help' for a list of available commands.",
                state: { processKilled: false, fileRemoved: false },
                malware: { pid: "31337", fileName: "b_door.php" },
                commands: {
                    help: () => `Available Commands:
  ls -l                
  uname -a             
  ps -ef              
  df -h            
  free -m           
  uptime          
  netstat -o        
  whoami           
  pwd                 
  rm <filename>  
  history         
  cat /etc/hosts     
  kill -9 <pid>       
  dmesg | tail      
  systemctl start     
  systemctl stop     
  iptables -L`,
'ls -l': () => {
    let fileList = `total 24
drwxr-xr-x 2 www-data www-data 4096 Sep 1 10:15 css
drwxr-xr-x 2 www-data www-data 4096 Sep 1 10:15 images
-rw-r--r-- 1 www-data www-data 8734 Sep 1 10:20 index.html`;
    if (!simData.consoles.webServer.state.fileRemoved) {
        fileList += `\n-rwxr-xr-x 1 www-data www-data 1024 Sep 5 09:31 b_door.php`;
    }
    return fileList;
},
                    'ps -ef': () => {
                        let processList = `UID      PID   PPID  C STIME TTY          TIME CMD
root       1      0  0 10:20 ?        00:00:01 /sbin/init
root     755      1  0 10:20 ?        00:00:00 /usr/sbin/cron -f
root     789      1  0 10:21 ?        00:00:02 /usr/sbin/rsyslogd -n
root     800      1  0 10:21 ?        00:00:05 /usr/sbin/sshd -D
www-data 850      1  0 10:22 ?        00:00:10 /usr/sbin/apache2 -k start`;
                        if (!simData.consoles.webServer.state.processKilled) {
                            processList += `\nwww-data 31337  850  5 10:30 ?        00:05:00 httpd-worker`;
                        }
                        return processList;
                    },
                    'netstat -o': () => {
                        let netstatList = `Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      800/sshd
tcp        0      0 127.0.0.1:80            0.0.0.0:*               LISTEN      850/apache2
tcp        0      0 10.0.0.5:54321          10.0.0.6:3306           ESTABLISHED 850/apache2`;
                        if (!simData.consoles.webServer.state.processKilled) {
                            netstatList += `\ntcp        0      0 10.0.0.5:443            28.47.62.125:49152      ESTABLISHED 31337/httpd-worker`;
                        }
                        return netstatList;
                    },
'systemctl start apache2': () => 'Job for apache2.service started.',
'systemctl stop apache2': () => 'Job for apache2.service stopped.',
'uname -a': () => 'Linux webserver 5.15.0-generic #102-Ubuntu SMP Tue Aug 15 12:47:22 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux',
'df -h': () => `Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1        40G   12G   28G  30% /
udev            1.9G     0  1.9G   0% /dev
tmpfs           395M  1.2M  394M   1% /run`,
'free -m': () => `              total        used        free      shared  buff/cache   available
Mem:           3948         743        2564          12         640        2951
Swap:          2047           0        2047`,
'uptime': () => ' 10:45:12 up 2 days, 18 min,  1 user,  load average: 0.05, 0.08, 0.07',
'whoami': () => 'www-data',
'pwd': () => '/var/www/html',
'history': () => `  1 ls -l
  2 ps -ef
  3 netstat -o
  4 history`,
'cat /etc/hosts': () => `127.0.0.1   localhost
10.0.0.5    webserver.internal.corp webserver`,
'dmesg | tail': () => `[172800.123456] new high-speed USB device number 8 using xhci_hcd
[172801.567890] usb 2-2: New USB device found, idVendor=0bda, idProduct=8153
[172802.901234] usb 2-2: New USB device strings: Mfr=1, Product=2, SerialNumber=6
[172803.345678] cdc_ether 2-2:1.0 eth1: register 'cdc_ether' at usb-0000:00:14.0-2, CDC Ethernet Device, 00:e0:4c:53:44:58`,
'iptables -L': () => `Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:ssh
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:http
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:https`
                }
            },
            crmServer: {
                 prompt: "crmserver> ",
                welcome: "Connection established to CRM Server.\nType 'help' for a list of available commands.",
                state: { processKilled: true, fileRemoved: true },
                commands: {
                    help: () => `Available Commands:
  ls -l  
  uname -r    
  ps -ef        
  df -h           
  free -m      
  uptime          
  whoami          
  rm <filename>      
  pwd               
  history            
  cat /etc/resolv.conf 
  dmesg | tail        
  kill -9 <pid>        
  chkconfig            
  systemctl start     
  systemctl stop     
  sestatus`,
                    'ls -l': () => `total 20
drwxr-x--- 2 crm-user crm-user 4096 Sep 4 14:01 bin
drwxr-x--- 2 crm-user crm-user 4096 Sep 4 14:01 lib
drwxrwxr-x 2 crm-user crm-user 4096 Sep 5 11:00 logs
-rw-r----- 1 crm-user crm-user 3072 Sep 4 14:00 config.xml`,
                    'ps -ef': () => `UID      PID   PPID  C STIME TTY          TIME CMD
root       1      0  0 11:00 ?        00:00:01 /sbin/init
root     750      1  0 11:01 ?        00:00:04 /usr/sbin/sshd -D
mysql    810      1  0 11:02 ?        00:00:12 /usr/sbin/mysqld
crm-user 900      1  0 11:05 ?        00:02:15 /opt/crm/bin/crm-daemon
root    1050      1  0 11:07 ?        00:00:00 /usr/sbin/cron -f`,
'chkconfig': () => `sshd           	0:off	1:off	2:on	3:on	4:on	5:on	6:off
crm-daemon     	0:off	1:off	2:on	3:on	4:on	5:on	6:off
rsyslog        	0:off	1:off	2:on	3:on	4:on	5:on	6:off
crond          	0:off	1:off	2:on	3:on	4:on	5:on	6:off`,
'systemctl start crm-daemon': () => 'Job for crm-daemon.service started.',
'systemctl stop crm-daemon': () => 'Job for crm-daemon.service stopped.',
'uname -r': () => '4.18.0-305.el8.x86_64',
'df -h': () => `Filesystem      Size  Used Avail Use% Mounted on
/dev/mapper/rl-root   50G   18G   32G  36% /
/dev/sda1        1014M  215M  800M  22% /boot
/dev/mapper/rl-home   20G  1.2G   19G   6% /home`,
'free -m': () => `              total        used        free      shared  buff/cache   available
Mem:           7801         950        5850          10        1000        6550
Swap:          4095           0        4095`,
'uptime': () => ' 11:15:30 up 28 days, 4:32,  1 user,  load average: 0.01, 0.03, 0.05',
'whoami': () => 'crm-user',
'pwd': () => '/opt/crm/logs',
'history': () => `  1 ls
  2 ps -a
  3 history`,
'cat /etc/resolv.conf': () => `nameserver 10.0.0.2
nameserver 8.8.8.8
search internal.corp`,
'dmesg | tail': () => `[2419200.111111] EXT4-fs (sda1): mounted filesystem with ordered data mode. Opts: (null)
[2419201.222222] systemd[1]: Starting LVM2 PV scan on device 8:1.
[2419202.333333] systemd[1]: Started LVM2 PV scan on device 8:1.
[2419203.444444] SELinux:  policy capability network_peer_controls=1.`,
'sestatus': () => `SELinux status:                 enabled
SELinuxfs mount:                /sys/fs/selinux
SELinux root directory:         /etc/selinux
Loaded policy name:             targeted
Current mode:                   enforcing
Mode from config file:          enforcing
Policy MLS status:              enabled
Policy deny_unknown status:     allowed
Memory protection checking:     actual (secure)
Max kernel policy version:      33`
                }
            }
        }
    };
document.getElementById('infoBtn').addEventListener('click', () => {
    const infoModal = document.getElementById('infoModal');
    if (infoModal) {
        infoModal.querySelector('.modal-body').textContent = simData.info;
        infoModal.style.display = 'flex';
    }
});
    function generateTableFromData(data) {
        let tableHTML = '<table><thead><tr>';
        data.headers.forEach(header => tableHTML += `<th>${header}</th>`);
        tableHTML += '</tr></thead><tbody>';
        data.rows.forEach(row => {
            tableHTML += '<tr>';
            row.forEach(cell => tableHTML += `<td>${cell}</td>`);
            tableHTML += '</tr>';
        });
        tableHTML += '</tbody></table>';
        return tableHTML;
    }
function openModal(modalId) {
    const modal = document.getElementById(modalId);
    if (!modal) {
        console.error('Modal not found:', modalId);
        return;
    }

    const feedData = simData.threatFeeds[modalId];
    const modalContent = modal.querySelector('.modal-content');

    let tableHTML = '<table><thead><tr>';
    feedData.headers.forEach(h => tableHTML += `<th>${h}</th>`);
    tableHTML += '</tr></thead><tbody>';
    feedData.rows.forEach(row => {
        tableHTML += '<tr>';
        row.forEach(cell => tableHTML += `<td>${cell}</td>`);
        tableHTML += '</tr>';
    });
    tableHTML += '</tbody></table>';

    modalContent.innerHTML = `
        <div class="browser-bar">
            <div class="window-controls">
                <span class="dot red"></span>
                <span class="dot yellow"></span>
                <span class="dot green"></span>
            </div>
            <div class="address-bar">${feedData.url}</div>
        </div>
        <div class="modal-body">
            <h3>${feedData.title}</h3>
            ${tableHTML}
        </div>
    `;

    modal.style.display = 'flex'; 
}

    function createTerminal(terminalId, consoleData) {
        const terminal = document.getElementById(terminalId);
        terminal.innerHTML = `
            <div class="terminal-output">${consoleData.welcome}</div>
            <div class="terminal-input-line">
                <span class="terminal-prompt">${consoleData.prompt}</span>
                <input type="text" class="terminal-input">
            </div>`;
        const input = terminal.querySelector('.terminal-input');
        const output = terminal.querySelector('.terminal-output');

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && input.value.trim() !== '') {
                const commandStr = input.value.trim();
                const [command, ...args] = commandStr.split(' ');
                output.textContent += `\n${consoleData.prompt}${commandStr}`;
                
                let response;
                const simpleCommand = consoleData.commands[commandStr];

                if (typeof simpleCommand === 'function') {
                    response = simpleCommand();
                } else if (command === 'kill' && args[0] === '-9' && args[1]) {
                    if (consoleData.malware && args[1] === consoleData.malware.pid) {
                        consoleData.state.processKilled = true;
                        response = `Process with PID ${args[1]} has been terminated.`;
                    } else {
                        response = `Error: No process with PID ${args[1]} found.`;
                    }
                } else if (command === 'rm' && args[0]) {
                     if (consoleData.malware && args[0] === consoleData.malware.fileName) {
                        consoleData.state.fileRemoved = true;
                        response = `File '${args[0]}' has been removed.`;
                    } else {
                        response = `Error: Cannot remove '${args[0]}': No such file or directory.`;
                    }
                } else {
                    response = `Command not found: ${command}`;
                }
                
                output.textContent += `\n${response}`;
                input.value = '';
                output.scrollTop = output.scrollHeight;
            }
        });
    }

    function switchTerminalTab(targetTerminalId) {
        document.querySelectorAll('.terminal').forEach(term => term.classList.remove('active'));
        document.querySelectorAll('.terminal-tab-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(targetTerminalId).classList.add('active');
        document.querySelector(`.terminal-tab-btn[data-terminal="${targetTerminalId}"]`).classList.add('active');
    }

    function checkAnswers() {
        const ws = simData.consoles.webServer.state;
        const crm = simData.consoles.crmServer.state;

        if (ws.processKilled && ws.fileRemoved && crm.processKilled && crm.fileRemoved) {
             alert("Correct! You have successfully identified and remediated the compromise on the Web Server and verified the CRM Server is clean.");
        } else {
            let message = "Incorrect. Review your actions:\n";
            if (!ws.processKilled) message += "- The malicious process on the Web Server is still running.\n";
            if (!ws.fileRemoved) message += "- The malicious file on the Web Server has not been removed.\n";
            alert(message);
        }
    }

    function resetSim() {
        location.reload();
    }

    createTerminal('webServer', simData.consoles.webServer);
    createTerminal('crmServer', simData.consoles.crmServer);

    document.querySelectorAll('.terminal-tab-btn').forEach(btn => {
        btn.addEventListener('click', () => switchTerminalTab(btn.dataset.terminal));
    });

    document.querySelectorAll('.grid-item[data-modal]').forEach(item => {
        item.addEventListener('click', () => {
            openModal(item.dataset.modal);
        });
    });

    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });
    });

    document.getElementById('resetBtn').addEventListener('click', resetSim);
    document.getElementById('checkBtn').addEventListener('click', checkAnswers);
});



</script>
<script src="../../../../disable_dev_tools.js"></script>
</body>
</html>