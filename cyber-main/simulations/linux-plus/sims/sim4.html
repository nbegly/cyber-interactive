<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sim 4: Log Parsing</title>
    <link rel="stylesheet" href="/cyber-main/assets/style.css">
    <style>
        .sim-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .info-btn {
            padding: 8px;
            background-color: var(--interactive-blue);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
            line-height: 0;
        }

        .info-btn:hover {
            background-color: var(--interactive-blue-hover);
        }

        .info-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        #sim4-layout {
            display: flex;
            flex-wrap: wrap;
            gap: 40px;
        }

        .sim4-commands-panel {
            flex: 1;
            min-width: 300px;
        }

        .sim4-commands-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .drag-option {
            background: var(--bg-dark-tertiary);
            padding: 10px;
            border-radius: 5px;
            cursor: grab;
            user-select: none;
            border: 1px solid var(--border-color);
        }

        .drag-option:active {
            cursor: grabbing;
            background-color: var(--accent-green);
        }

        .sim4-output-panel {
            flex: 2;
            min-width: 450px;
        }

        .sim4-tabs .tab-button {
            background: var(--bg-dark-tertiary);
            color: var(--text-light);
            border: 1px solid var(--border-color);
            border-bottom: none;
            margin-right: 5px;
            padding: 10px 15px;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
        }

        .sim4-tabs .tab-button.active-tab {
            background: var(--accent-green);
            color: var(--bg-dark-primary);
            font-weight: bold;
        }

        .sim4-drop-area {
            display: flex;
            align-items: center;
            background: #1e1e1e;
            padding: 10px;
            border-radius: 8px 8px 0 0;
        }

        .sim4-prompt {
            color: #88ff88;
            margin-right: 10px;
            font-family: monospace;
        }

        .sim4-dropzone {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 40px;
            background: #333;
            padding: 10px;
            border-radius: 5px;
            border: 2px dashed var(--interactive-blue);
            font-size: 1em;
            color: #ccc;
            cursor: pointer;
            transition: background 0.2s, border-color 0.2s;
        }

        .sim4-dropzone.drag-over {
            background: #555;
            border-color: var(--accent-green-hover);
        }

        pre.sim4-output {
            background: #1e1e1e;
            color: #eee;
            padding: 18px;
            border-radius: 0 0 12px 12px;
            font-size: 1em;
            margin: 0 0 20px 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 1px solid #1e1e1e;
            border-top: none;
        }

        .sim-button-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .sim-view-list-btn {
            background-color: var(--interactive-blue);
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
        }

        .sim-view-list-btn:hover {
            background-color: var(--interactive-blue-hover);
        }

        .log-output {
            background-color: #1e1e1e;
            color: #eee;
            font-family: monospace;
            padding: 15px;
            border-radius: 5px;
            text-align: left;
            white-space: pre;
            font-size: 0.9em;
            max-height: 400px;
            overflow-y: auto;
        }

    </style>
</head>
<body>

    <div class="sim-container">
        <div class="sim-top-bar">
            <a href="/cyber-main/simulations/linux-plus/index.html" class="back-btn">Back to Linux+ Menu</a>
            <button id="infoBtn" class="info-btn" title="Show Instructions">
                <svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </button>
        </div>

        <h3>Sim 4: Log Parsing</h3>
        <p>You have been asked to parse a log file to determine various information. Drag the correct command to produce the output shown on each page.</p>
        
        <div id="sim4-layout">
            </div>
        
        <div class="sim-controls">
            <div></div> <button class="sim-reset-btn" id="resetBtn">Reset Sim</button>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <pre id="modal-body-content" style="white-space: pre-wrap; font-family: sans-serif;"></pre>
            <button class="modal-close-btn">Close</button>
        </div>
    </div>
<!-- === MODAL FOR YOUR LOG FILE === -->
    <div id="commandListModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-top:0; margin-bottom: 1rem;">Log File</h2>
            <pre class="log-output">
comptia  pts/0        :0                Sat Mar 11 09:45 - 10:55  (01:10)
eric     pts/1        :0                Sat Mar 11 10:00 - 12:32  (02:32)
chris    pts/2        :0                Sat Mar 11 11:25 - 11:55  (00:30)
reboot   system boot  3.10.0-693.21.1.  Sat Mar 11 08:55 - 16:00  (07:05)
comptia  pts/1        :0                Sun Mar 12 14:20 - 09:48  (1+19:28)
chris    pts/2        :0                Sun Mar 12 14:52 - 09:48  (1+18:56)
reboot   system boot  3.10.0-693.21.1.  Sun Mar 12 11:01 - 13:26  (2+02:24)
lee      pts/2        :0                Sun Mar 12 14:52 - 09:48  (1+18:56)
comptia  pts/0        :0                Sun Mar 12 14:14 - 14:22  (00:07)
eric     pts/2        :0                Sun Mar 12 14:52 - 09:48  (1+18:56)
comptia  pts/0        :0                Sun Mar 12 11:37 - 11:58  (00:20)
reboot   system boot  3.10.0-693.21.1.  Sun Mar 12 11:02 - 13:26  (2+02:23)
david    pts/2        :0                Sun Mar 12 14:52 - 09:48  (1+18:56)
comptia  pts/0        :0                Sun Mar 12 09:53 - 10:59  (01:05)
comptia               :0                Sun Mar 12 11:01 - 11:01  (00:00)
reboot   system boot  3.10.0-693.21.1.  Sun Mar 12 10:59 - 13:26  (2+02:26)
eric     pts/3        :0                Mon Mar 13 10:52 - 08:48  (1+12:50)
david    pts/3        :0                Mon Mar 13 10:52 - 08:48  (1+12:50)
ann      pts/3        :0                Mon Mar 13 10:52 - 08:48  (1+12:50)
chris    pts/3        :0                Mon Mar 13 10:52 - 08:48  (1+12:50)
carl     pts/3        :0                Mon Mar 13 10:52 - 08:48  (1+12:50)
joe      pts/3        :0                Mon Mar 13 10:52 - 08:48  (1+12:50)
lee      pts/3        :0                Mon Mar 13 10:52 - 08:48  (1+12:50)
comptia  pts/0        :0                Tue Mar 14 09:35 - 10:45  (01:10)
ann      pts/1        :0                Tue Mar 14 10:10 - 11:25  (01:15)
carl     pts/2        :0                Tue Mar 14 11:00 - 12:55  (01:55)
chris    pts/4        :0                Tue Mar 14 14:15 - 15:10  (00:55)
reboot   system boot  3.10.0-693.21.1.  Tue Mar 14 08:55 - 16:00  (07:05)</pre>
            <button class="modal-close-btn" style="margin-top: 1.5rem;">Close</button>
        </div>
    </div>
    </div>
    <script>
        const modal = document.getElementById("modal");
        const modalBody = document.getElementById("modal-body-content");
        function showModal(message, isCentered = false) {
            modalBody.textContent = message;
            modal.querySelector('.modal-content').classList.toggle('centered-text', isCentered);
            modal.style.display = "flex";
        }
        function closeModal() { modal.style.display = "none"; }
        modal.querySelector('.modal-close-btn').onclick = closeModal;
        modal.onclick = e => { if (e.target.id === 'modal') closeModal(); };

        const commandListModal = document.getElementById("commandListModal");
        function showCommandListModal() { commandListModal.style.display = "flex"; }
        function closeCommandListModal() { commandListModal.style.display = "none"; }
        commandListModal.querySelector('.modal-close-btn').onclick = closeCommandListModal;
        commandListModal.onclick = e => { if (e.target.id === 'commandListModal') closeCommandListModal(); };

        const sim4 = {
            dom: {
                layout: document.getElementById('sim4-layout')
            },
            data: {
                info: `DRAG DROP -\nYou have been asked to parse a log file of logins to determine various information about who is logging in and when.\n\nINSTRUCTIONS -\nOpen and inspect the Login log file.\n\nDrag and drop the correct commands onto the output that was generated from that command.`,
                correctCommands: [`grep "Mar 13" log.txt`, `tr "[a-z]" "[A-Z]" < log.txt | grep -i "mar 12"`, `awk '{ print $1 }' log.txt | sort | uniq`],
                outputs: [
                    `eric     pts/3        :0       Mon Mar 13 10:52 - 08:48  (1+12:50)\ndavid    pts/3        :0       Mon Mar 13 10:52 - 08:48  (1+12:50)\nann      pts/3        :0       Mon Mar 13 10:52 - 08:48  (1+12:50)\nchris    pts/3        :0       Mon Mar 13 10:52 - 08:48  (1+12:50)\ncarl     pts/3        :0       Mon Mar 13 10:52 - 08:48  (1+12:50)\njoe      pts/3        :0       Mon Mar 13 10:52 - 08:48  (1+12:50)\nlee      pts/3        :0       Mon Mar 13 10:52 - 08:48  (1+12:50)`,
                    `COMPTIA\t PTS/1\t\t:0\t\t SUN MAR 12 14:20\t09:48\t1+19:28\nCHRIS\t PTS/2\t\t:0\t\t SUN MAR 12 14:52\t09:48\t1+18:56\nREBOOT\t SYSTEM BOOT\t3.10.0-693.21.1. SUN MAR 12 11:01\t13:26\t2+02:24\nLEE\t PTS/2\t\t:0\t\t SUN MAR 12 14:52\t09:48\t1+18:56\nCOMPTIA\t PTS/0\t\t:0\t\t SUN MAR 12 14:14\t14:22\t00:07\nERIC\t PTS/2\t\t:0\t\t SUN MAR 12 14:52\t09:48\t1+18:56\nCOMPTIA\t PTS/0\t\t:0\t\t SUN MAR 12 11:37\t11:58\t00:20\nREBOOT\t SYSTEM BOOT\t3.10.0-693.21.1. SUN MAR 12 11:02\t13:26\t2+02:23\nDAVID\t PTS/2\t\t:0\t\t SUN MAR 12 14:52\t09:48\t1+18:56\nCOMPTIA\t PTS/0\t\t:0\t\t SUN MAR 12 09:53\t10:59\t01:05\nCOMPTIA\t\t\t:0\t\t SUN MAR 12 11:01\t11:01\t00:00\nREBOOT\t SYSTEM BOOT\t3.10.0-693.21.1. SUN MAR 12 10:59\t13:26\t2+02:26\nCOMPTIA\t\t\t:0\t\t SUN MAR 12 11:03\t13:26\t2+02:22\nCOMPTIA\t PTS/2\t\t:0\t\t SUN MAR 12 14:52\t09:48\t1+18:56\nANN\t PTS/2\t\t:0\t\t SUN MAR 12 14:52\t09:48\t1+18:56\nCARL\t PTS/2\t\t:0\t\t SUN MAR 12 14:52\t09:48\t1+18:56\nREBOOT\t SYSTEM BOOT\t3.10.0-693.EL7.X SUN MAR 12 09:39\t10:59\t01:19\nJOE\t PTS/2\t\t:0\t\t SUN MAR 12 14:52\t09:48\t1+18:56\nCOMPTIA\t\t\t:0\t\t SUN MAR 12 09:43\tDOWN\t01:15\nCOMPTIA\t PTS/0\t\t:0\t\t SUN MAR 12 11:04\t11:34\t00:30`,
                    `ann\ncarl\nchris\ncomptia\ndavid\neric\njoe\nlee\nreboot`
                ],
                commandBank: [`tr "[a-z]" "[A-Z]" < log.txt | grep -i "mar 12"`, `awk '{print $1}' log.txt | uniq`, `grep -i "mar 12" log.txt | sed 's/[a-z]/[A-Z]/g'`, `grep "Mar 13" log.txt`, `awk '{ print $1 }' log.txt | sort | uniq -c`, `awk '{ print toupper($0) }' log.txt`, `awk '{ print $1 }' log.txt | sort | uniq`, `grep "Mar13" log.txt`, `grep log.txt "Mar 13"`, `tr "[A-Z]" "[a-z]" < log.txt | grep -i "mar 12"`, `awk '{ print $2 }' log.txt | sort | uniq`]
            },
            state: {},
            setup: function() {
                this.state.activeTab = 0;
                this.state.tabAnswers = ["", "", ""];
                this.state.shuffledCommands = [...this.data.commandBank].sort(() => Math.random() - 0.5);
                this.render();
            },
            render: function() {
                const tabs = [0, 1, 2].map(i => `<button class="tab-button ${this.state.activeTab === i ? "active-tab" : ""}" data-tab="${i}">Page ${i + 1}</button>`).join("");
                const bank = this.state.shuffledCommands.map(cmd => `<div class="drag-option" draggable="true">${cmd}</div>`).join("");
                
                this.dom.layout.innerHTML = `
                    <div class="sim4-commands-panel">
                        <h4>Commands</h4>
                        <div class="sim4-commands-list">${bank}</div>
                    </div>
                    <div class="sim4-output-panel">
                        <div class="sim4-tabs">${tabs}</div>
                        <div class="sim4-drop-area">
                            <span class="sim4-prompt">[comptia@localhost exercise]$</span>
                            <div class="sim4-dropzone"><span>${this.state.tabAnswers[this.state.activeTab] || "Drop command here"}</span></div>
                        </div>
                        <pre class="sim4-output">${this.data.outputs[this.state.activeTab]}</pre>
                        <div class="sim-button-container">
                             <button class="sim-check-btn" id="checkPageBtn">Check This Page</button>
                            <button class="sim-view-list-btn" id="viewListBtn">Log File</button>
                        </div>
                    </div>
                `;
                this.attachEvents();
            },
            attachEvents: function() {
                this.dom.layout.querySelector('.sim4-tabs').addEventListener("click", e => {
                    if (e.target.matches(".tab-button")) {
                        this.state.activeTab = parseInt(e.target.dataset.tab, 10);
                        this.render();
                    }
                });

                this.dom.layout.querySelector("#viewListBtn").addEventListener("click", showCommandListModal);
                
                this.dom.layout.querySelector("#checkPageBtn").addEventListener("click", () => {
                    const userAnswer = (this.state.tabAnswers[this.state.activeTab] || "").replace(/\s+/g, " ").trim();
                    const correctAnswer = this.data.correctCommands[this.state.activeTab].replace(/\s+/g, " ").trim();
                    showModal(userAnswer === correctAnswer ? `Page ${this.state.activeTab + 1} is correct!` : "Incorrect command for this page. Try again!");
                });

                const draggables = this.dom.layout.querySelectorAll(".drag-option");
                const dropzone = this.dom.layout.querySelector(".sim4-dropzone");

                draggables.forEach(draggable => {
                    draggable.addEventListener("dragstart", e => e.dataTransfer.setData("text/plain", e.target.innerText))
                });
                
                dropzone.addEventListener("dragover", e => {
                    e.preventDefault();
                    dropzone.classList.add("drag-over");
                });
                dropzone.addEventListener("dragleave", () => dropzone.classList.remove("drag-over"));
                dropzone.addEventListener("drop", e => {
                    e.preventDefault();
                    dropzone.classList.remove("drag-over");
                    this.state.tabAnswers[this.state.activeTab] = e.dataTransfer.getData("text/plain");
                    this.render(); 
                });
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            sim4.setup();
            document.getElementById('resetBtn').addEventListener('click', () => sim4.setup());
            document.getElementById('infoBtn').onclick = () => {
                showModal(sim4.data.info);
            };
        });
    </script>
<script src="/cyber-main/disable_dev_tools.js"></script>
</body>
</html>