<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sim 8: Tar Backup and Restore</title>
    <link rel="stylesheet" href="../../../assets/style.css">
    <style>
        .sim-top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .info-btn { padding: 8px; background-color: var(--interactive-blue); border: none; border-radius: 5px; cursor: pointer; color: white; line-height: 0; }
        .info-btn:hover { background-color: var(--interactive-blue-hover); }
        .info-btn svg { width: 24px; height: 24px; fill: currentColor; }

        #sim-main-container {
            background-color: var(--bg-dark-secondary);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        .tab-nav {
            display: flex;
            border-bottom: 1px solid var(--interactive-blue);
        }
        .tab-btn {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            background-color: var(--bg-dark-tertiary);
            border: 1px solid var(--border-color);
            border-bottom: none;
            color: var(--text-muted);
            font-size: 1.1em;
            border-radius: 8px 8px 0 0;
        }
        .tab-btn.active {
            background-color: var(--interactive-blue);
            color: white;
            border-color: var(--interactive-blue);
        }
        .tab-content {
            padding: 1.5rem;
            background-color: var(--bg-dark);
            border: 1px solid var(--interactive-blue);
            border-top: none;
            border-radius: 0 0 8px 8px;
        }
        .command-objects-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        .command-object {
            background-color: #3d3d3d; 
            color: white;
            font-family: monospace;
            font-weight: bold;
            text-align: center;
            padding: 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: transform 0.1s ease;
        }
        .command-object:hover {
            transform: scale(1.05);
        }
        .command-object:active {
            transform: scale(0.98);
        }
        .command-bar {
            margin-top: 1.5rem;
            background-color: #2a2a2e;
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            align-items: center;
            font-family: monospace;
            font-size: 1.2em;
            color: #dcdcdc;
            border: 1px solid var(--border-color-light);
        }
        .command-bar-display {
            flex-grow: 1;
            white-space: pre;
        }
        .command-bar-mode {
            background-color: #4a4a4e;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin: 0 1rem;
        }
        .remove-btn {
            background-color: #c74242;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            font-size: 0.75em;
            font-family: sans-serif;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="sim-container">
        <div class="sim-top-bar">
            <a href="../index.html" class="back-btn">Back to Linux+ Menu</a>
            <button id="infoBtn" class="info-btn" title="Show Instructions">
                <svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </button>
        </div>

        <h3>Sim 8: Tar Backup and Restore</h3>
        
        <div id="sim-main-container">
            <div class="tab-nav">
                <button class="tab-btn active" data-tab="backup">Backup</button>
                <button class="tab-btn" data-tab="restore">Restore</button>
            </div>
            <div class="tab-content">
                <div class="command-objects-grid" id="command-objects-grid">
                    </div>
            </div>

            <div class="command-bar">
                <div class="command-bar-display">
                    <span style="color: #1eff8e;">tar </span><span id="command-built"></span>
                </div>
                <div class="command-bar-mode" id="command-mode">Backup</div>
                <button class="remove-btn" id="remove-btn" title="Remove Last Selection">Back</button>
            </div>
        </div>
        
        <div class="sim-controls">
             <div></div>
             <div>
                <button class="sim-check-btn" id="checkBtn">Check Answer</button>
                <button class="sim-reset-btn" id="resetBtn">Reset All</button>
             </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <pre id="modal-body-content" style="white-space: pre-wrap; font-family: sans-serif;"></pre>
            <button class="modal-close-btn">Close</button>
        </div>
    </div>

    <script>
        const modal = document.getElementById("modal");
        const modalBody = document.getElementById("modal-body-content");
        function showModal(message, isCentered = false) {
            modalBody.textContent = message;
            modal.querySelector('.modal-content').classList.toggle('centered-text', isCentered);
            modal.style.display = "flex";
        }
        function closeModal() { modal.style.display = "none"; }
        modal.querySelector('.modal-close-btn').onclick = closeModal;
        modal.onclick = e => { if (e.target.id === 'modal') closeModal(); };

        const simTar = {
            data: {
                info: `You are a systems administrator and have created an uncompressed backup of the application directory. Several hours later, you must restore the application from backup.\n\nINSTRUCTIONS\nWithin each tab, click on an object to form the appropriate command used to create the backup and restore the application.\n\nCommand objects may only be used once, but the spacebar object may be used multiple times. Not all objects will be used. Click the arrow to remove any unwanted objects from your command.`,
                objects: [
                    "-cvf", "-d", "-xvf", "-cjvf", "/backups/application.tar", "/",
                    "-tvf", "/backups/application.tar.gz", "application", "/home/",
                    "-xzvf", "/opt/", "/backups/application.tar.bz2", "-c",
                    "-xvf", " ", "-C", "/backups/application.tgz"
                ],
                correctAnswers: {
                    backup: ["-cvf", " ", "/backups/application.tar", " ", "application"],
                    restore: ["-xvf", " ", "/backups/application.tar"]
                }
            },
            state: {
                currentTab: "backup",
                backupCommand: [],
                restoreCommand: []
            },
            setup: function() {
                this.state = { currentTab: "backup", backupCommand: [], restoreCommand: [] };
                
                const grid = document.getElementById('command-objects-grid');
                grid.innerHTML = '';
                const shuffledObjects = [...this.data.objects].sort(() => Math.random() - 0.5);

                shuffledObjects.forEach(objText => {
                    const objDiv = document.createElement('div');
                    objDiv.className = 'command-object';
                    objDiv.textContent = objText === " " ? "[spacebar]" : objText;
                    objDiv.dataset.value = objText;
                    grid.appendChild(objDiv);
                });
                this.switchTab('backup');
            },
            renderCommandBar: function() {
                const command = this.state.currentTab === 'backup' ? this.state.backupCommand : this.state.restoreCommand;
                document.getElementById('command-built').textContent = command.join('');
            },
            switchTab: function(tabName) {
                console.log("Switching tabs and clearing state...");
                this.state.backupCommand = [];
                this.state.restoreCommand = [];
                this.state.currentTab = tabName;
                    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.tab === tabName));
                const modeLabel = document.getElementById('command-mode');
                    if (tabName === 'backup') {
                        modeLabel.textContent = 'Backup';
                    } else {
                        modeLabel.textContent = 'Restore';
                    }
                this.renderCommandBar();
            },
            addToCommand: function(value) {
                if (this.state.currentTab === 'backup') {
                    this.state.backupCommand.push(value);
                } else {
                    this.state.restoreCommand.push(value);
                }
                this.renderCommandBar();
            },
            removeLast: function() {
                 if (this.state.currentTab === 'backup') {
                    this.state.backupCommand.pop();
                } else {
                    this.state.restoreCommand.pop();
                }
                this.renderCommandBar();
            },
            check: function() {
                const isBackupCorrect = JSON.stringify(this.state.backupCommand) === JSON.stringify(this.data.correctAnswers.backup);
                const isRestoreCorrect = JSON.stringify(this.state.restoreCommand) === JSON.stringify(this.data.correctAnswers.restore);

                if (isBackupCorrect && isRestoreCorrect) {
                    showModal("Correct! Both the backup and restore commands are correct.", true);
                } else {
                    let feedback = "";
                    feedback += `Backup Command: ${isBackupCorrect ? 'Correct' : 'Incorrect'}\n`;
                    feedback += `Restore Command: ${isRestoreCorrect ? 'Correct' : 'Incorrect'}`;
                    showModal(feedback, true);
                }
            },
            init: function() {
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', () => this.switchTab(btn.dataset.tab));
                });
                document.getElementById('command-objects-grid').addEventListener('click', (e) => {
                    if (e.target.classList.contains('command-object')) {
                        this.addToCommand(e.target.dataset.value);
                    }
                });
                document.getElementById('remove-btn').addEventListener('click', () => this.removeLast());
                document.getElementById('checkBtn').addEventListener('click', () => this.check());
                document.getElementById('resetBtn').addEventListener('click', () => this.setup());
                document.getElementById('infoBtn').addEventListener('click', () => showModal(this.data.info));
                
                this.setup();
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            simTar.init();
        });
    </script>
</body>
</html>