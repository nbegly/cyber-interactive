<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sim 3: Apache Install</title>
    <link rel="stylesheet" href="../../../assets/style.css">
    <style>
        .sim-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .info-btn {
            padding: 8px;
            background-color: var(--interactive-blue);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
            line-height: 0;
        }

        .info-btn:hover {
            background-color: var(--interactive-blue-hover);
        }

        .info-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }
        
        #terminal-wrapper {
            background-color: var(--bg-dark-secondary);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        #terminal-output { 
            background: #000; 
            color: #0f0; 
            padding: 15px; 
            border-radius: 5px; 
            height: 400px; 
            overflow-y: auto; 
            margin-bottom: 10px; 
            font-family: monospace; 
            white-space: pre-wrap; 
        }

        .command-line {
            display: flex;
            background: #000;
            border-radius: 5px;
            padding: 0 10px;
            border: 1px solid #333;
        }

        .prompt {
            color: #88ff88;
            font-family: monospace;
            line-height: 40px; 
            white-space: nowrap;
        }

        #command-input { 
            width: 100%; 
            box-sizing: border-box; 
            padding: 10px; 
            font-family: monospace; 
            border: none;
            background: transparent; 
            color: #fff; 
        }

        #command-input:focus {
            outline: none;
        }

    </style>
</head>
<body>

    <div class="sim-container">
        <div class="sim-top-bar">
            <a href="../index.html" class="back-btn">Back to Linux+ Menu</a>
            <button id="infoBtn" class="info-btn" title="Show Instructions">
                <svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </button>
        </div>

        <h3>Sim 3: Apache Install</h3>
        <p>A junior administrator had trouble installing and running an Apache web server. Install Apache, resolve the issue preventing it from starting, and verify that it's running.</p>
        
        <div id="terminal-wrapper">
             <div id="terminal-output"></div>
             <div class="command-line">
                <span class="prompt">root@localhost ~#&nbsp;</span>
                <input id="command-input" type="text" autocomplete="off" autofocus>
             </div>
        </div>
        
        <div class="sim-controls">
            <div></div>
            <div>
                <button class="sim-reset-btn" id="resetBtn">Reset Sim</button>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <pre id="modal-body-content" style="white-space: pre-wrap; font-family: sans-serif;"></pre>
            <button class="modal-close-btn">Close</button>
        </div>
    </div>

    <script>
        const modal = document.getElementById("modal");
        const modalBody = document.getElementById("modal-body-content");
        function showModal(message, isCentered = false) {
            modalBody.textContent = message;
            modal.querySelector('.modal-content').classList.toggle('centered-text', isCentered);
            modal.style.display = "flex";
        }
        function closeModal() { modal.style.display = "none"; }
        modal.querySelector('.modal-close-btn').onclick = closeModal;
        modal.onclick = e => { if (e.target.id === 'modal') closeModal(); };

        const sim3 = {
            data: {
                info: `SIMULATION -\nJunior system administrator had trouble installing and running an Apache web server on a Linux server. You have been tasked with installing the Apache web server on the Linux server and resolving the issue that prevented the junior administrator from running Apache. \n\nINSTRUCTIONS -\nInstall Apache and start the service. Verify that the Apache service is running with the defaults.\nTyping “help” in the terminal will show a list of relevant event commands.`
            },
            state: {
                nginxKilled: false,
                apacheInstalled: false
            },
            dom: {
                terminalOutput: document.getElementById('terminal-output'),
                commandInput: document.getElementById('command-input')
            },
            commands: {
                "yum install httpd": `Loaded plugins: fastestmirror, langpacks\nLoading mirror speeds from cached hostfile\n * base: mirror.steadfast.net\n * extras: mirror.steadfast.net\n * updates: mirror.steadfast.net\nResolving Dependencies\n--> Running transaction check\n---> Package httpd.x86_64 0:2.4.6-97.el7.centos will be installed\n--> Finished Dependency Resolution\n\nDependencies Resolved\n================================================================================\n Package         Arch       Version                  Repository          Size\n================================================================================\nInstalling:\n httpd           x86_64     2.4.6-97.el7.centos      updates            2.7 M\n...\n\nInstalled:\n  httpd.x86_64 0:2.4.6-97.el7.centos\nComplete!`,
                "systemctl enable --now httpd": `Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.`,
                "netstat -tunlp | grep 80": `tcp        0      0 0.0.0.0:80              0.0.0.0:* LISTEN      987/nginx`,
                "pkill nginx": "",
                "systemctl restart httpd": ""
            },
            statusOutput: {
                failed: `● httpd.service - The Apache HTTP Server\n   Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled; vendor preset: disabled)\n   Active: failed (Result: exit-code) since Tue 2025-06-17 11:55:10 EDT; 14s ago\n     Docs: man:httpd.service(8)\n  Process: 2514 ExecStart=/usr/sbin/httpd $OPTIONS -DFOREGROUND (code=exited, status=1/FAILURE)\n Main PID: 2514 (code=exited, status=1/FAILURE)\n\nJun 17 11:55:10 localhost.localdomain systemd[1]: Starting The Apache HTTP Server...\nJun 17 11:55:10 localhost.localdomain httpd[2514]: (98)Address already in use: AH00072: make_sock: could not bind to address [::]:80\nJun 17 11:55:10 localhost.localdomain systemd[1]: httpd.service: Main process exited, code=exited, status=1/FAILURE\nJun 17 11:55:10 localhost.localdomain systemd[1]: Failed to start The Apache HTTP Server.`,
                success: `● httpd.service - The Apache HTTP Server\n   Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled; vendor preset: disabled)\n   Active: active (running) since Tue 2025-06-17 11:59:10 EDT; 1s ago\n     Docs: man:httpd.service(8)\n Main PID: 2831 (httpd)\n   Status: "Running, listening on: port 80"\n\nJun 17 11:59:09 localhost.localdomain systemd[1]: Starting The Apache HTTP Server...\nJun 17 11:59:10 localhost.localdomain systemd[1]: Started The Apache HTTP Server.`
            },
            setup: function() {
                this.state.nginxKilled = false;
                this.state.apacheInstalled = false;
                this.dom.terminalOutput.innerHTML = '';
                this.dom.commandInput.value = '';
                this.appendToTerminal("Install Apache and start the service. Verify that the Apache service is running with the defaults. Begin troubleshooting.");
                this.dom.commandInput.focus();
            },
            appendToTerminal: function(text) {
                this.dom.terminalOutput.innerHTML += text.replace(/\n/g, "<br>") + "<br>";
                this.dom.terminalOutput.scrollTop = this.dom.terminalOutput.scrollHeight;
            },
            executeCommand: function() {
                const command = this.dom.commandInput.value.trim();
                if (!command) return;
                
                this.dom.commandInput.value = "";
                this.appendToTerminal(`\n<span style="color: #88ff88;">root@localhost ~#</span> ${command}`);
                
                if (command === "help") {
                    const helpText = `Available Commands:\nsystemctl enable --now httpd\nsystemctl reload sshd\nsystemctl status httpd\napache2ctl configtest\nss -tunlp | grep 22\nsystemctl restart httpd\nyum install httpd\nnetstat -tunlp | grep 80\njournalctl -u mysql\nfirewall-cmd --add-service=https\nsystemctl --now enable nginx\npkill nginx\nsystemctl mask httpd\nservice mysql restart\n`;
                    this.appendToTerminal(helpText);
                    return;
                }
                
                if (command === "yum install httpd") {
                    this.state.apacheInstalled = true;
                    this.appendToTerminal(this.commands[command]);
                } else if (!this.state.apacheInstalled && command !== "help") {
                    this.appendToTerminal(`-bash: ${command}: command not found. Hint: Try installing the required package first.`);
                } else if (command === "pkill nginx") {
                    this.state.nginxKilled = true;
                    this.appendToTerminal("nginx process killed.");
                } else if (command === "systemctl status httpd") {
                    const output = this.state.nginxKilled ? this.statusOutput.success : this.statusOutput.failed;
                    this.appendToTerminal(output);
                    if (this.state.nginxKilled) {
                        showModal("Correct! Apache is now running successfully.", true);
                    }
                } else if (this.commands[command] !== undefined) {
                    this.appendToTerminal(this.commands[command]);
                } else {
                    this.appendToTerminal(`-bash: command not found: ${command}`);
                }
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            sim3.setup();
            sim3.dom.commandInput.addEventListener("keydown", event => {
                if (event.key === "Enter") {
                    sim3.executeCommand();
                }
            });
            document.getElementById('resetBtn').addEventListener('click', () => sim3.setup());
            document.getElementById('infoBtn').onclick = () => {
                showModal(sim3.data.info);
            };
        });
    </script>
<script src="/cyber-main/disable_dev_tools.js"></script>
</body>
</html>