<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sim 2: Shell Script</title>
    <link rel="stylesheet" href="../../../assets/style.css">
    <style>
        /* Sim-specific styles */
        .sim-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .info-btn {
            padding: 8px;
            background-color: var(--interactive-blue);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
            line-height: 0;
        }
        .info-btn:hover {
            background-color: var(--interactive-blue-hover);
        }
        .info-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        /* Styles for Sim 2 Drag and Drop */
        #sim2-layout {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .sim2-snippets-panel {
            flex: 1;
            min-width: 300px;
            background-color: var(--bg-dark-secondary);
            padding: 1rem;
            border-radius: 8px;
            word-wrap: break-word;
            border: 1px solid var(--border-color);
        }
        .sim2-snippets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
        }
        .drag-option {
            background-color: var(--bg-dark-tertiary);
            color: var(--text-light);
            padding: 10px;
            border-radius: 5px;
            cursor: grab;
            user-select: none;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        .drag-option:active {
            cursor: grabbing;
            background: var(--accent-green);
        }
        .sim2-script-panel {
            background-color: #1e1e1e;
            color: #e0e0e0;
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 1.1em;
            line-height: 2.8;
            flex: 1.5;
            border: 1px solid #333;
        }
        .sim2-dropzone {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
            background: #2c3e50;
            color: #ecf0f1;
            min-width: 120px;
            height: 40px;
            padding: 5px;
            margin: 0 5px;
            border-radius: 8px;
            border: 2px dashed #3498db;
            font-weight: 700;
            transition: background-color .2s, border-color .2s;
        }
        .sim2-dropzone.drag-over {
            background-color: #34495e;
            border-color: #5dade2;
        }
    </style>
</head>
<body>

    <div class="sim-container">
        <div class="sim-top-bar">
            <a href="../index.html" class="back-btn">Back to Linux+ Menu</a>
            <button id="infoBtn" class="info-btn" title="Show Instructions">
                <svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </button>
        </div>

        <h3>Sim 2: Shell Script</h3>
        <p>Drag and drop the snippets to complete the shell script.</p>
        
        <div id="sim2-layout">
            </div>
        
        <div class="sim-controls">
            <div></div>
            <div>
                <button class="sim-check-btn" id="checkBtn">Check Answer</button>
                <button class="sim-reset-btn" id="resetBtn">Reset Sim</button>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <pre id="modal-body-content" style="white-space: pre-wrap; font-family: sans-serif;"></pre>
            <button class="modal-close-btn">Close</button>
        </div>
    </div>

    <script>
        // --- Shared Modal Logic ---
        const modal = document.getElementById("modal");
        const modalBody = document.getElementById("modal-body-content");
        function showModal(message, isCentered = false) {
            modalBody.textContent = message;
            modal.querySelector('.modal-content').classList.toggle('centered-text', isCentered);
            modal.style.display = "flex";
        }
        function closeModal() { modal.style.display = "none"; }
        modal.querySelector('.modal-close-btn').onclick = closeModal;
        modal.onclick = e => { if (e.target.id === 'modal') closeModal(); };

        // --- Sim-specific JavaScript ---
        const sim2 = {
            data: {
                info: `DRAG DROP -\nAs a System Administrator, to reduce disk space, your were tasked to create a shell script that does the following: \nAdd relevent content to /tmp/script.sh, so that it finds and compresses related files in /var/log without recursion.\n\nINSTRUCTIONS -\nDrag and drop snippets to fill the blanks to build a script that performs the actual compression of rotated log files.`
            },
            setup: function() {
                const container = document.getElementById('sim2-layout');
                const snippets = ["done", "while", "xz", "pgrep", "locate", "for", "sed", "filename", "until", "tar", "then", "$log", "egrep", "$log. [1-6]$", "log.[1-6]$", "$1", "repeat", "in", "/tmp/tempfile", "/var/log", "zip", "gzip", "rar", "awk", "$6"];
                snippets.sort(() => Math.random() - 0.5);
                
                const snippetBank = snippets.map(snippet => `<div class="drag-option" draggable="true">${snippet}</div>`).join("");

                container.innerHTML = `
                    <div class="sim2-snippets-panel">
                        <h4>Snippets</h4>
                        <div class="sim2-snippets-grid">${snippetBank}</div>
                    </div>
                    <div class="sim2-script-panel">
                        <div>#!/bin/bash</div>
                        <div>find /var/log -type f -maxdepth 1 | grep <span class="sim2-dropzone">?</span> > /tmp/tempfile</div>
                        <div><span class="sim2-dropzone">?</span> filename <span class="sim2-dropzone">?</span> $(cat <span class="sim2-dropzone">?</span>); do</div>
                        <div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sim2-dropzone">?</span> $filename</div>
                        <div><span class="sim2-dropzone">?</span></div>
                    </div>
                `;
                this.enableDragAndDrop();
            },
            enableDragAndDrop: function() {
                const draggables = document.querySelectorAll(".drag-option");
                const dropzones = document.querySelectorAll(".sim2-dropzone");

                draggables.forEach(draggable => {
                    draggable.addEventListener("dragstart", e => {
                        e.dataTransfer.setData("text/plain", e.target.innerText);
                    });
                });

                dropzones.forEach(zone => {
                    zone.addEventListener("dragover", e => {
                        e.preventDefault();
                        zone.classList.add("drag-over");
                    });
                    zone.addEventListener("dragleave", () => {
                        zone.classList.remove("drag-over");
                    });
                    zone.addEventListener("drop", e => {
                        e.preventDefault();
                        zone.classList.remove("drag-over");
                        const data = e.dataTransfer.getData("text/plain");
                        zone.innerText = data;
                        zone.style.borderColor = "#3498db"; // Reset border color on drop
                    });
                });
            },
            check: function() {
                const dropzones = document.querySelectorAll(".sim2-dropzone");
                const correctAnswers = ["log.[1-6]$", "for", "in", "/tmp/tempfile", "gzip", "done"];
                let isCorrect = true;

                dropzones.forEach((zone, index) => {
                    if (zone.innerText.trim() !== correctAnswers[index]) {
                        isCorrect = false;
                        zone.style.borderColor = 'var(--danger-red)'; // Highlight incorrect dropzones
                    } else {
                        zone.style.borderColor = 'var(--accent-green)'; // Highlight correct dropzones
                    }
                });
                
                showModal(isCorrect ? "Correct! The script is complete." : "Incorrect. Please review your script. The incorrect sections are highlighted in red.");
            }
        };

        // Initialize the simulation when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            sim2.setup();
            document.getElementById('checkBtn').addEventListener('click', () => sim2.check());
            document.getElementById('resetBtn').addEventListener('click', () => sim2.setup());
            document.getElementById('infoBtn').onclick = () => {
                showModal(sim2.data.info);
            };
        });
    </script>
</body>
</html>