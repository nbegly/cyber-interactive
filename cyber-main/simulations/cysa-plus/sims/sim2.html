<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sim: Vulnerability Remediation</title>
    <link rel="stylesheet" href="/cyber-main/assets/style.css">
    <style>

        .sim-container {
            width: 100%;
            max-width: 1000px;
            background-color: var(--bg-dark-secondary);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .sim-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .sim-btn {
            padding: 10px 15px;
            background-color: var(--accent-green);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
            font-size: 0.9em;
        }

        .sim-btn:hover { 
            background-color: var(--accent-green-hover); 
        }

        .tabs { 
            display: flex; margin-bottom: 15px; border-bottom: 1px solid var(--border-color); 
        }

        .tab-btn {
            padding: 12px 18px;
            cursor: pointer;
            background-color: transparent;
            border: none;
            color: var(--text-dark);
            font-size: 1em;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            border-bottom-color: var(--accent-green);
            color: var(--text-light);
            font-weight: 600;
        }

        .tab-content { 
            display: none; padding: 10px; 
        }

        .tab-content.active { 
            display: block; 
        }
        
        .answer-section {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-top: 20px;
        }

        .answer-group { 
            flex: 1; min-width: 300px; 
        }
        .answer-group label { 
            display: block; margin-bottom: 10px; font-weight: 600; 
        }

        .answer-group select {
            width: 100%;
            padding: 10px;
            background-color: var(--bg-dark-main);
            color: var(--text-light);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1em;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .checkbox-grid label { 
            font-weight: normal; 
        }

        table { 
            width: 100%; border-collapse: collapse; 
        }

        th, td { 
            padding: 12px; 
            text-align: left; 
            border-bottom: 1px solid var(--border-color); 
        }

        th { 
            background-color: #3c3c3c; 
        }

        .output-entry { 
            margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px dashed var(--border-color); 
        }

        .output-entry:last-child { 
            border-bottom: none; 
        }

        .output-entry b { 
            display: inline-block; width: 150px; font-weight: bold; color: #a9d1a9; 
        }
        
        .sim-controls {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            gap: 10px;
        }

        .modal { 
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); justify-content: center; align-items: center; 
        }

        .modal-content { 
            background-color: var(--bg-dark-secondary); padding: 25px; border: 1px solid var(--border-color); border-radius: 8px; width: 90%; max-width: 500px; 
        }

        .modal-close-btn { 
            display: block; margin: 20px auto 0; 
        }

        .output-row {
            display: flex;
            margin-bottom: 4px;
        }

        .output-row b {
            flex-shrink: 0; 
            width: 150px;
            font-weight: bold;
            color: #a9d1a9;
        }

        .output-row span {
            flex-grow: 1; 
        }
    </style>
</head>
<body>
    <div class="sim-container">
        <div class="sim-top-bar">
            <a href="/cyber-main/simulations/cysa-plus/index.html" class="back-btn">Back to CySA+ Menu</a>
            <button id="infoBtn" class="info-btn" title="Show Instructions">
                <svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </button>
        </div>

        <h3>Vulnerability Scan Review</h3>

        <div class="tabs">
            <button class="tab-btn active" data-tab="timeframes">Vulnerability remediation timeframes</button>
            <button class="tab-btn" data-tab="environment">Environment</button>
            <button class="tab-btn" data-tab="output">Output</button>
        </div>

        <div id="timeframes" class="tab-content active"></div>
        <div id="environment" class="tab-content"></div>
        <div id="output" class="tab-content"></div>

        <div class="answer-section">
            <div class="answer-group">
                <label>Select the server to be patched within 14 calendar days:</label>
                <div id="servers" class="checkbox-grid"></div>
            </div>
            <div class="answer-group">
                <label>Select the appropriate technique and mitigation:</label>
                <select id="mitigation"></select>
            </div>
        </div>

        <div class="sim-controls">
            <button class="sim-check-btn" id="checkBtn">Check Answer</button>
            <button class="sim-reset-btn" id="resetBtn">Reset Sim</button>
        </div>
    </div>

    <div id="modal" class="modal"><div class="modal-content"><div id="modal-body-content"></div><button class="sim-btn modal-close-btn" onclick="closeModal()">Close</button></div></div>

    <script>
        const modal = document.getElementById("modal");
        const modalBody = document.getElementById("modal-body-content");
        function showModal(content) { modalBody.innerHTML = `<p style="white-space: pre-wrap;">${content}</p>`; modal.style.display = "flex"; }
        function closeModal() { modal.style.display = "none"; }
        modal.onclick = e => { if (e.target.id === 'modal') closeModal(); };

        const sim = {
            state: {
                servers: [],
                mitigation: ''
            },
            data: {
                info: `
SCENARIO
A systems administrator is reviewing the output of a vulnerability scan.

INSTRUCTIONS
- Review the information in each tab.
- Based on the organization's environment architecture and remediation standards, select the server to be patched within 14 days.
- Select the appropriate technique and mitigation.

If at any time you would like to bring back the initial state of the simulation, please click the "Reset Sim" button.`,
timeframes: `
    <table>
        <tr>
            <th style="min-width: 150px;">CVSS risk level</th>
            <th>Standard</th>
            <th>Applies To OPS</th>
            <th>Applies To TEST</th>
            <th>Applies To STAGE</th>
        </tr>
        <tr>
            <td>CVSS > 9.0</td>
            <td>Must be patched or remediated and verified by a subsequent vulnerability scan within <b>7 calendar days<b></td>
            <td class="checkmark"><svg width="20" height="20" viewBox="0 0 24 24" fill="#2b9a2b" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.646 17.646L3.99997 13L2.58575 14.4142L8.646 20.4745L21.646 7.47451L20.2318 6.06029L8.646 17.646Z" /></svg></td>
            <td class="checkmark"><svg width="20" height="20" viewBox="0 0 24 24" fill="#2b9a2b" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.646 17.646L3.99997 13L2.58575 14.4142L8.646 20.4745L21.646 7.47451L20.2318 6.06029L8.646 17.646Z" /></svg></td>
            <td>❌</td>
        </tr>
        <tr>
            <td>CVSS > 7.9 < 9.0</td>
            <td>Must be patched or remediated and verified by a subsequent vulnerability scan within <b>14 calendar days<b></td>
            <td class="checkmark"><svg width="20" height="20" viewBox="0 0 24 24" fill="#2b9a2b" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.646 17.646L3.99997 13L2.58575 14.4142L8.646 20.4745L21.646 7.47451L20.2318 6.06029L8.646 17.646Z" /></svg></td>
            <td>❌</td>
            <td>❌</td>
        </tr>
        <tr>
            <td>CVSS > 5.0 < 7.9</td>
            <td>Must be patched or remediated and verified by a subsequent vulnerability scan within <b>30 calendar days<b></td>
            <td class="checkmark"><svg width="20" height="20" viewBox="0 0 24 24" fill="#2b9a2b" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.646 17.646L3.99997 13L2.58575 14.4142L8.646 20.4745L21.646 7.47451L20.2318 6.06029L8.646 17.646Z" /></svg></td>
            <td>❌</td>
            <td>❌</td>
        </tr>
        <tr>
            <td>CVSS > 0 < 5.0</td>
            <td>Must be patched or remediated and verified by a subsequent vulnerability scan within <b>60 calendar days<b></td>
            <td class="checkmark"><svg width="20" height="20" viewBox="0 0 24 24" fill="#2b9a2b" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.646 17.646L3.99997 13L2.58575 14.4142L8.646 20.4745L21.646 7.47451L20.2318 6.06029L8.646 17.646Z" /></svg></td>
            <td>❌</td>
            <td>❌</td>
        </tr>
        <tr>
            <table>
<br></br><strong>Any of these timeframes may be accelerated at the discretion of the Chief Information Security Officer (CISO).</strong><br></br>If patching cannot be completed or a vendor has not made a patch available within the timeframe in the table outlined above, compensating controls must be put in place within the timeframes listed above and the exception process must be followed.<br></br>If a patch requires a reboot for installation, the reboot must occur within the timeframes outlined above.<br></br>All mitigations must be tested in the lower environments before being promoted to operations.<br></br>Appropriate risk management processes should be considered when an applicable timeframe is not required for an environment.
            </table>
        </tr>    
    </table>`,
                environment: `
                    <table>
                        <tr><th>Environment name</th><th>Environment location</th><th>Subnets</th><th>Domain</th><th>Publicly accessible</th><th>NGFW</th><th>Load balancer</th><th>MFA required</th></tr>
                        <tr><td>ops.comptia.org</td><td>External</td><td>203.17.18.20, 203.17.18.30, 192.168.60.0/24, 192.168.61.0/24</td><td>comptia.org</td><td>Yes</td><td>Yes</td><td>Yes</td><td>No</td></tr>
                        <tr><td>stage.comptia.org</td><td>Internal</td><td>192.168.76.0/24, 192.168.75.0/24</td><td>comptia.org</td><td>No</td><td>Yes</td><td>Yes</td><td>Yes</td></tr>
                        <tr><td>test.comptia.org</td><td>External</td><td>192.168.50.0/24, 192.168.51.0/24</td><td>comptia.org</td><td>No</td><td>Yes</td><td>Yes</td><td>Yes</td></tr>
                    </table>`,
                output: [
                    { title: "Microsoft IIS: Unsupported software version detected", desc: "The software version detected is no longer supported.", asset: "192.168.76.50", risk: "Unpatched software", ref: "CVE-2022-0155, CVSS 9.2" },
                    { title: "Sensitive cookie in HTTPS session without 'secure' attribute", desc: "The secure attribute for sensitive cookies in HTTPS sessions is not set, which could cause the user agent to send those cookies in plaintext over HTTP session.", asset: "192.168.76.60", risk: "Session sidejacking", ref: "CVE-2021-0462, CVSS 7.4" },
                    { title: "Untrusted SSL/TLS Server X.509 certificate", desc: "The server's TLS/SSL certificate is signed by a certificate authority that is untrusted or unknown.", asset: "192.168.51.32", risk: "May allow on-path attackers to insert a spoofed certificate...", ref: "CVE-2021-1234, CVSS 8.1" },
                    { title: "Sensitive cookie in HTTPS session without 'secure' attribute", desc: "The secure attribute for sensitive cookies in HTTPS sessions is not set...", asset: "192.168.60.45", risk: "Session sidejacking", ref: "CVE-2021-0462, CVSS 7.4" },
                    { title: "Web server is susceptible to TLS downgrade attacks", desc: "The server permits the web client to select and use its own preferences.", asset: "192.168.60.90", risk: "May allow data to be vulnerable.", ref: "CVE-2021-1234, CVSS 8.1" },
                    { title: "Basic authentication", desc: "Website is configured to permit use of .htaccess files on directories.", asset: "192.168.51.90", risk: "May allow privileged access to sensitive data.", ref: "CVE-2021-38361, CVSS 5.1" }
                ],
                servers: ["192.168.51.90", "192.168.51.32", "192.168.60.45", "192.168.76.50", "192.168.60.90", "192.168.76.60"],
                mitigations: ["Select", 
                "Request exception; legacy protocol could have operational impact", 
                "Reconfigure; transition to a new identity and access manager", 
                "Reconfigure; upgrade IIS to current release", 
                "Request exception; organization needs time to procure a PKI",
                "Compensating control; implement MFA on the application",
                "Reconfigure; restrict to use only modern cipher suites",
                "Compensating control; create new ACL on firewall to block port 443",
                "Compensating control; implement secure session tokens"],
                correctAnswers: {
                    servers: ["192.168.60.90"],
                    mitigation: "Install a trusted SSL certificate"
                }
            },
            setup: function() {
                this.state = { servers: [], mitigation: '' };
                document.getElementById('timeframes').innerHTML = this.data.timeframes;
                document.getElementById('environment').innerHTML = this.data.environment;
                const outputContainer = document.getElementById('output');
                outputContainer.innerHTML = '';
                this.data.output.forEach(item => {
                    outputContainer.innerHTML += `<div class="output-entry">
    <div class="output-row"><b>Title:</b> <span>${item.title}</span></div>
    <div class="output-row"><b>Description:</b> <span>${item.desc}</span></div>
    <div class="output-row"><b>Affected asset:</b> <span>${item.asset}</span></div>
    <div class="output-row"><b>Risk:</b> <span>${item.risk}</span></div>
    <div class="output-row"><b>Reference:</b> <span>${item.ref}</span></div>
</div>`;
                });
                const serversContainer = document.getElementById('servers');
                serversContainer.innerHTML = '';
                this.data.servers.forEach(s => {
                    serversContainer.innerHTML += `<label><input type="checkbox" name="server" value="${s}"> ${s}</label>`;
                });
                const mitigationSelect = document.getElementById('mitigation');
                mitigationSelect.innerHTML = '';
                this.data.mitigations.forEach(m => {
                    mitigationSelect.innerHTML += `<option value="${m}">${m}</option>`;
                });
                document.querySelectorAll('input[name="server"]').forEach(chk => chk.checked = false);
                mitigationSelect.value = "Select";
            },
            check: function() {
                if (this.state.servers.length === 0 || !this.state.mitigation || this.state.mitigation === 'Select') {
                    showModal("Please select at least one server and a mitigation technique.");
                    return;
                }
                const correctServers = this.data.correctAnswers.servers;
                const selectedServers = this.state.servers.sort();
                const serversMatch = correctServers.length === selectedServers.length && correctServers.every((val, index) => val === selectedServers[index]);
                const mitigationMatch = this.state.mitigation === this.data.correctAnswers.mitigation;

                if (serversMatch && mitigationMatch) {
                    showModal("Correct! You have successfully identified the server and the appropriate mitigation technique based on the organization's policies.");
                } else {
                    let feedback = "One or more of your answers are incorrect.\n\n";
                    feedback += `Server Selection: ${serversMatch ? 'Correct' : 'Incorrect'}\n`;
                    feedback += `Mitigation Technique: ${mitigationMatch ? 'Correct' : 'Incorrect'}`;
                    showModal(feedback);
                }
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            sim.setup();
            document.getElementById('resetBtn').addEventListener('click', () => sim.setup());
            document.getElementById('checkBtn').addEventListener('click', () => sim.check());
            document.getElementById('infoBtn').addEventListener('click', () => {
                showModal(sim.data.info);})
            
            document.querySelectorAll('.tab-btn').forEach(btn => btn.addEventListener('click', (e) => sim.openTab(e)));
            document.querySelectorAll('input[name="server"]').forEach(chk => {
                chk.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        sim.state.servers.push(e.target.value);
                    } else {
                        sim.state.servers = sim.state.servers.filter(s => s !== e.target.value);
                    }
                });
            });
            document.getElementById('mitigation').addEventListener('change', (e) => sim.state.mitigation = e.target.value);
        });

        sim.openTab = function(evt) {
            const tabName = evt.currentTarget.dataset.tab;
            document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(tb => tb.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
        };
    </script>
<script src="/cyber-main/disable_dev_tools.js"></script>
</body>
</html>