<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sim 5: Data Classification</title>
    <!-- Link to the shared stylesheet -->
    <link rel="stylesheet" href="../../../assets/style.css">
    <style>
        /* Sim-specific styles */
        .sim-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .info-btn {
            padding: 8px;
            background-color: var(--interactive-blue);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
            line-height: 0;
        }
        .info-btn:hover {
            background-color: var(--interactive-blue-hover);
        }
        .info-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }
        .sim5-main-container { 
            display: flex; 
            gap: 15px; 
            margin-top: 20px;
        }
        .sim5-column { 
            flex: 1; 
        }
        .sim5-draggable-bank { 
            background: var(--bg-dark-secondary); 
            padding: 10px; 
            border-radius: 8px; 
            border: 1px solid var(--border-color);
        }
        .sim5-data-item { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            margin-bottom: 10px; 
        }
        .sim5-draggable { 
            background: var(--accent-green); 
            color: white; 
            padding: 10px; 
            border-radius: 50%; 
            width: 30px; 
            height: 30px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            flex-shrink: 0; 
            cursor: grab; 
            font-weight: bold; 
            user-select: none;
        }
        .sim5-data-text { 
            background: var(--bg-dark-tertiary); 
            color: var(--text-light); 
            padding: 10px; 
            border-radius: 5px; 
            flex-grow: 1; 
            border: 1px solid var(--border-color); 
        }
        .sim5-category-box { 
            background: var(--bg-dark-secondary); 
            border: 1px solid var(--border-color); 
            border-radius: 8px; 
            padding: 15px; 
            margin-bottom: 10px; 
        }
        .sim5-dropzone { 
            min-height: 50px; 
            background: var(--bg-dark-tertiary); 
            border: 2px dashed var(--border-color); 
            border-radius: 5px; 
            margin-top: 5px; 
            padding: 5px; 
            display: flex; 
            flex-wrap: wrap; 
            gap: 5px; 
            align-items: flex-start;
        }
        .sim5-dropzone.drag-over { 
            background: var(--interactive-blue-hover); 
            border-color: var(--accent-green); 
        }
    </style>
</head>
<body>

    <div class="sim-container">
        <div class="sim-top-bar">
            <a href="../index.html" class="back-btn">Back to Menu</a>
            <button id="infoBtn" class="info-btn" title="Show Instructions">
                <svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </button>
        </div>

        <h3>Sim 5: Data Classification</h3>
        <div class="sim5-main-container">
            <div class="sim5-column" id="sim5-drag-bank">
                <h4>Drag & Drop</h4>
                <div class="sim5-draggable-bank">
                    <!-- Draggable items will be inserted here by the script -->
                </div>
            </div>
            <div class="sim5-column">
                <h4>Data Classification</h4>
                <div class="sim5-category-box"><b>PII</b><div class="sim5-dropzone" data-category="pii" data-type="classification"></div></div>
                <div class="sim5-category-box"><b>PHI</b><div class="sim5-dropzone" data-category="phi" data-type="classification"></div></div>
                <div class="sim5-category-box"><b>Intellectual Property</b><div class="sim5-dropzone" data-category="ip" data-type="classification"></div></div>
                <div class="sim5-category-box"><b>Corporate Confidential</b><div class="sim5-dropzone" data-category="confidential" data-type="classification"></div></div>
                <div class="sim5-category-box"><b>Public</b><div class="sim5-dropzone" data-category="public" data-type="classification"></div></div>
            </div>
            <div class="sim5-column">
                <h4>Data Destruction Method</h4>
                <div class="sim5-category-box"><b>Degaussing and Multi-Pass Wipe</b><div class="sim5-dropzone" data-category="degauss" data-type="destruction"></div></div>
                <div class="sim5-category-box"><b>Physical Destruction via Shredding</b><div class="sim5-dropzone" data-category="shred" data-type="destruction"></div></div>
            </div>
        </div>
        <div class="sim-controls">
            <div></div>
            <div>
                <button class="sim-check-btn" id="checkBtn">Check Answer</button>
                <button class="sim-reset-btn" id="resetBtn">Reset Sim</button>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div id="modal-body-content"></div>
            <button class="modal-close-btn" onclick="closeModal()">Close</button>
        </div>
    </div>

    <script>
        const modal = document.getElementById("modal");
        const modalBody = document.getElementById("modal-body-content");
        function showModal(content, isCentered = true) {
            modalBody.innerHTML = '';
            if (typeof content === 'string') {
                const p = document.createElement('p');
                p.style.whiteSpace = 'pre-wrap';
                p.textContent = content;
                modalBody.appendChild(p);
            } else {
                modalBody.appendChild(content);
            }
            modal.querySelector('.modal-content').classList.toggle('centered-text', isCentered);
            modal.style.display = "flex";
        }
        function closeModal() { modal.style.display = "none"; }
        modal.onclick = e => { if (e.target.id === 'modal') closeModal(); };

        const sim5 = {
            data: {
                info: "SIMULATION\nA data owner has been tasked with assigning proper data classifications and destruction methods for various types of data contained within the environment.\n\nINSTRUCTIONS\nFrom the options below, drag each item to its appropriate classification as well as the MOST appropriate form of disposal.\n\nIf at any time you would like to bring back the initial state of the simulation, please click the Reset Sim button.",
                dataItems: [
                    { id: 1, text: "Bound copies of internal audit reports from a private company" },
                    { id: 2, text: "Copies of financial audit reports from exchange-traded organizations on a flash drive" },
                    { id: 3, text: "Database containing driver's license information on a reusable backup tape" },
                    { id: 4, text: "Decommissioned mechanical hard drive containing application source code" },
                    { id: 5, text: "Employee records on an SSD" },
                    { id: 6, text: "Paper-based customer records, which include medical data" }
                ],
                correctAnswers: {
                    classification: { confidential: ["1"], public: ["2"], pii: ["3", "5"], phi: ["6"], ip: ["4"] },
                    // **FIXED** Corrected the destruction methods based on media type
                    destruction: { degauss: ["3", "4"], shred: ["1", "2", "5", "6"] }
                }
            },
            setup: function() {
                const bank = document.querySelector('.sim5-draggable-bank');
                bank.innerHTML = this.data.dataItems.map(item => `
                    <div class="sim5-data-item">
                        <div class="sim5-data-text">${item.text}</div>
                        <div class="sim5-draggable" draggable="true" data-id="${item.id}">${item.id}</div>
                    </div>
                `).join('');

                document.querySelectorAll('.sim5-dropzone').forEach(zone => zone.innerHTML = '');

                let draggedItem = null;
                document.querySelectorAll('.sim5-draggable').forEach(item => {
                    item.ondragstart = e => {
                        draggedItem = e.target;
                        e.dataTransfer.setData('text/plain', e.target.dataset.id);
                    };
                });

                document.querySelectorAll('.sim5-dropzone').forEach(zone => {
                    zone.ondragover = e => { e.preventDefault(); zone.classList.add('drag-over'); };
                    zone.ondragleave = () => zone.classList.remove('drag-over');
                    zone.ondrop = e => {
                        e.preventDefault();
                        zone.classList.remove('drag-over');
                        if (draggedItem) {
                            const clone = draggedItem.cloneNode(true);
                            zone.appendChild(clone);
                        }
                    };
                });
            },
            check: function() {
                let allCorrect = true;
                for (const type in this.data.correctAnswers) {
                    for (const category in this.data.correctAnswers[type]) {
                        const zone = document.querySelector(`.sim5-dropzone[data-category="${category}"][data-type="${type}"]`);
                        const droppedIds = Array.from(zone.querySelectorAll('.sim5-draggable')).map(el => el.dataset.id).sort();
                        const correctIds = [...this.data.correctAnswers[type][category]].sort();
                        
                        if (JSON.stringify(droppedIds) !== JSON.stringify(correctIds)) {
                            allCorrect = false;
                            break;
                        }
                    }
                    if (!allCorrect) break;
                }
                showModal(allCorrect ? "Correct!" : "Incorrect. Please review your classifications and destruction methods.");
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            sim5.setup();
            document.getElementById('checkBtn').addEventListener('click', () => sim5.check());
            document.getElementById('resetBtn').addEventListener('click', () => sim5.setup());
            document.getElementById('infoBtn').onclick = () => {
                showModal(sim5.data.info, false);
            };
        });
    </script>
</body>
</html>
